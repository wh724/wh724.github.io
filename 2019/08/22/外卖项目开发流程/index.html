<!-- build time:Thu Aug 22 2019 15:41:08 GMT+0800 (GMT+08:00) --><!DOCTYPE html><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script><script>$("body").backstretch("https://c-ssl.duitang.com/uploads/item/201801/31/20180131162930_sSXWd.jpeg")</script><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Vue项目,Web APP,"><link rel="alternate" href="/atom.xml" title="Space Port" type="application/atom+xml"><meta name="description" content="外卖Web APP（spa）"><meta name="keywords" content="Vue项目,Web APP"><meta property="og:type" content="article"><meta property="og:title" content="外卖项目开发流程"><meta property="og:url" content="https://github.com/wh724/2019/08/22/外卖项目开发流程/index.html"><meta property="og:site_name" content="Space Port"><meta property="og:description" content="外卖Web APP（spa）"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://owoccema2.bkt.clouddn.com/Readme/vue/mintshop.png"><meta property="og:updated_time" content="2019-08-22T07:40:19.820Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="外卖项目开发流程"><meta name="twitter:description" content="外卖Web APP（spa）"><meta name="twitter:image" content="http://owoccema2.bkt.clouddn.com/Readme/vue/mintshop.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://github.com/wh724/2019/08/22/外卖项目开发流程/"><title>外卖项目开发流程 | Space Port</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a452b4c4a1cd7c9a9f62d952a88dc832";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Space Port</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">welcome to my space station!</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://github.com/wh724/2019/08/22/外卖项目开发流程/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="WH"><meta itemprop="description" content><meta itemprop="image" content="/images/wh724.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Space Port"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">外卖项目开发流程</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-22T15:37:40+08:00">2019-08-22 </time></span><span class="post-category"><span class="post-meta-divider">·</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span> </a></span></span><span class="post-wordcount"><span class="post-meta-divider">·</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span title="字数统计">17.7k </span><span class="post-meta-divider">·</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span title="阅读时长">80</span></span></div></header><div class="post-body" itemprop="articleBody"><center><i>外卖Web APP（spa）</i></center><image src="/2019/07/18/Hexo+NexT 打造自己的博客/hexo.jpg" alt style="width:100%"><a id="more"></a><h1 id="项目开发流程"><a href="#项目开发流程" class="headerlink" title="项目开发流程"></a>项目开发流程</h1><h2 id="1-创建客户端项目"><a href="#1-创建客户端项目" class="headerlink" title="1. 创建客户端项目"></a>1. 创建客户端项目</h2><h3 id="1-1-使用-vue-cli-脚手架-搭建项目"><a href="#1-1-使用-vue-cli-脚手架-搭建项目" class="headerlink" title="1.1 使用 vue-cli(脚手架)搭建项目"></a>1.1 使用 vue-cli(脚手架)搭建项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在Github新建Vue-MintShop项目,然后clone到本地</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:W-Qing/Vue-MintShop.git</span><br><span class="line"><span class="built_in">cd</span> Vue-MintShop</span><br><span class="line"><span class="comment">#创建客户端项目</span></span><br><span class="line">vue init webpack mintshop-client</span><br><span class="line"><span class="built_in">cd</span> mintshop-client</span><br><span class="line">npm install</span><br><span class="line">npm run dev 访问: localhost:8080</span><br></pre></td></tr></table></figure><h3 id="1-2-项目结构分析"><a href="#1-2-项目结构分析" class="headerlink" title="1.2 项目结构分析"></a>1.2 项目结构分析</h3><blockquote><p>*<em>MintShop-client *</em></p><ul><li>|– build : webpack 相关的配置文件夹(基本不需要修改)</li><li>|– build : webpack 相关的配置文件夹(基本不需要修改)</li><li>|– config: webpack 相关的配置文件夹(基本不需要修改)</li><li>|– index.js: 指定的后台服务的端口号和静态资源文件夹</li><li>|– node_modules</li><li>|– src : 源码文件夹</li><li>|– main.js: 应用入口 js （初始化vue实例并使用需要的插件 ）</li><li>|– static: 静态资源文件夹</li><li>|– .babelrc: babel 的配置文件</li><li>|– .editorconfig: 通过编辑器的编码/格式进行一定的配置</li><li>|– .eslintignore: eslint 检查忽略的配置</li><li>|– .eslintrc.js: eslint 检查的配置</li><li>|– .gitignore: git 版本管理忽略的配置</li><li>|– index.html: 默认的主渲染页面文件</li><li>|– package.json: 应用包配置文件</li><li>|– README.md: 应用描述说明的 readme 文件</li></ul></blockquote><h3 id="1-3-编码测试与打包发布项目"><a href="#1-3-编码测试与打包发布项目" class="headerlink" title="1.3 编码测试与打包发布项目"></a>1.3 编码测试与打包发布项目</h3><ul><li><p>编码测试</p><p>npm run dev</p><p>访问: <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a></p><p>编码, 自动编译打包(HMR), 查看效果</p></li><li><p>打包发布</p><p>npm run build</p><p>npm install -g serve</p><p>serve dist</p><p>访问: <a href="http://localhost:5000" target="_blank" rel="noopener">http://localhost:5000</a></p></li></ul><h2 id="2-功能需求分析"><a href="#2-功能需求分析" class="headerlink" title="2. 功能需求分析"></a>2. 功能需求分析</h2><ul><li>开发前应该首先完成功能模块的分析设计，这里我们可以直接运行项目查看功能演示 自己总结项目功能需求</li></ul><h2 id="3-开发资源准备"><a href="#3-开发资源准备" class="headerlink" title="3. 开发资源准备"></a>3. 开发资源准备</h2><ul><li>使用<a href="http://www.iconfont.cn/" target="_blank" rel="noopener">阿里巴巴矢量库</a></li><li>将想要的图标添加入库（购物车）</li><li>将购物车中的图标添加到项目中</li><li>生成项目图标的<a href="//at.alicdn.com/t/font_726904_68moeoeirj3.css">Font Class地址</a></li></ul><h2 id="4-Css-Reset、Fastclick与Stylus"><a href="#4-Css-Reset、Fastclick与Stylus" class="headerlink" title="4. Css Reset、Fastclick与Stylus"></a>4. Css Reset、Fastclick与Stylus</h2><h3 id="4-1-Css-Reset"><a href="#4-1-Css-Reset" class="headerlink" title="4.1 Css Reset"></a>4.1 Css Reset</h3><ul><li><p>在项目主目录下的static文件夹内新建css文件夹</p></li><li><p>在css文件夹内新建重置样式文件reset.css</p></li><li><p>在index.html 中引入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/reset.css"</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-2-Fastclick"><a href="#4-2-Fastclick" class="headerlink" title="4.2 Fastclick"></a>4.2 Fastclick</h3><blockquote><p>当用户一次点击屏幕之后，浏览器并不能立刻判断用户是要进行双击缩放，还是想要进行单击操作。因此，iOS Safari 就等待 300 毫秒，以判断用户是否再次点击了屏幕。 于是，300 毫秒延迟就这么诞生了。</p></blockquote><ul><li><p>安装fastclick库 解决点击响应延时 0.3s 问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm Install fastclick --save</span><br></pre></td></tr></table></figure></li><li><p>在main.js中引入，并绑定到body</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> FastClick <span class="keyword">from</span> <span class="string">'fastclick'</span></span><br><span class="line">FastClick.attach(<span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-3-Stylus"><a href="#4-3-Stylus" class="headerlink" title="4.3 Stylus"></a>4.3 Stylus</h3><ul><li><p>安装stylus依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install stylus stylus-loader --save-dev</span><br></pre></td></tr></table></figure></li><li><p>在common文件夹下新建stylus文件夹</p></li><li><p>在stylus文件加下面新建mixins.styl文件</p></li><li><p>注意在组件内编写样式时要声明lang和rel</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"stylus"</span> <span class="attr">rel</span>=<span class="string">"stylesheet/stylus"</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="5-源码目录设计"><a href="#5-源码目录设计" class="headerlink" title="5. 源码目录设计"></a>5. 源码目录设计</h2><p><img src="http://owoccema2.bkt.clouddn.com/Readme/vue/mintshop.png" alt="src目录结构"></p><h2 id="6-Vue组件化"><a href="#6-Vue组件化" class="headerlink" title="6. Vue组件化"></a>6. Vue组件化</h2><h3 id="6-1-分析整个项目的-vue-组件结构"><a href="#6-1-分析整个项目的-vue-组件结构" class="headerlink" title="6.1 分析整个项目的 vue 组件结构"></a>6.1 分析整个项目的 vue 组件结构</h3><blockquote><p><strong>src</strong></p><ul><li>|– components————非路由组件文件夹</li><li>|– FooterGuide—————底部组件文件夹<ul><li>|– FooterGuide.vue——–底部组件 vue</li></ul></li><li>|– pages—————–路由组件文件夹<ul><li>|– Msite—————首页组件文件夹<ul><li>|– Msite.vue——–首页组件 vue</li></ul></li><li>|– Search—————-搜索组件文件夹<ul><li>|– Search.vue———搜索组件 vue</li></ul></li><li>|– Order————–订单组件文件夹<ul><li>|– Order.vue——-订单组件 vue</li></ul></li><li>|– Profile————–个人组件文件夹<ul><li>|– Profile.vue——-个人组件 vue</li></ul></li></ul></li><li>|– App.vue—————应用根组件 vue</li><li>|– main.js—————应用入口 js</li></ul></blockquote><ol><li>页面底部的FooterGuide组件只是用来放pages里的组件的容器，所以它不是路由组件</li><li>页面最上面的标题栏在我们的项目中属于路由组件的组成部分（与中间内容部分在一起）</li><li>但每个路由组件中都有最顶部的组件且相似度很高，所以可以将其抽取成为一个单独的组件</li></ol><h3 id="6-2-编写vue组件模板文件"><a href="#6-2-编写vue组件模板文件" class="headerlink" title="6.2 编写vue组件模板文件"></a>6.2 编写vue组件模板文件</h3><ul><li>pages文件夹下的各个vue组件文件及App.vue和FooterGuide.vue都是这个初始空白模板</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;App vue template&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="7-引入Vue-router"><a href="#7-引入Vue-router" class="headerlink" title="7. 引入Vue-router"></a>7. 引入Vue-router</h2><p>###7.1 下载vue-router</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建项目时已下载</span></span><br><span class="line">npm install vue-router --save</span><br></pre></td></tr></table></figure><h3 id="7-2-编写router文件夹下的index-js"><a href="#7-2-编写router文件夹下的index-js" class="headerlink" title="7.2 编写router文件夹下的index.js"></a>7.2 编写router文件夹下的index.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  路由模块 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="comment">// 引入路由组件文件夹下的组件</span></span><br><span class="line"><span class="keyword">import</span> Msite <span class="keyword">from</span> <span class="string">'../pages/Msite/Msite.vue'</span></span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">'../pages/Search/Search.vue'</span></span><br><span class="line"><span class="keyword">import</span> Order <span class="keyword">from</span> <span class="string">'../pages/Order/Order.vue'</span></span><br><span class="line"><span class="keyword">import</span> Profile <span class="keyword">from</span> <span class="string">'../pages/Profile/Profile.vue'</span></span><br><span class="line"><span class="comment">// 全局注册Vue-router组件</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由表并导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="comment">//去掉地址中的哈希#</span></span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  routes: [&#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      redirect: <span class="string">'/msite'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/msite'</span>,</span><br><span class="line">      component: Msite,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/search'</span>,</span><br><span class="line">      component: Search,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/order'</span>,</span><br><span class="line">      component: Order,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/profile'</span>,</span><br><span class="line">      component: Profile,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="7-3-编写应用的入口文件main-js"><a href="#7-3-编写应用的入口文件main-js" class="headerlink" title="7.3 编写应用的入口文件main.js"></a>7.3 编写应用的入口文件main.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入路由 其实就是引入上一步配置好的路由表</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(app),</span><br><span class="line">  <span class="comment">// 为根组件加入路由</span></span><br><span class="line">  router</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="7-4-在App-vue里使用router-view"><a href="#7-4-在App-vue里使用router-view" class="headerlink" title="7.4 在App.vue里使用router-view"></a>7.4 在App.vue里使用router-view</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 修改应用组件的模板 --&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;!-- 设置路由组件的视图位置 --&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;!-- 并放置非路由组件 --&gt;</span><br><span class="line">    &lt;FooterGuide&gt;&lt;/FooterGuide&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import FooterGuide from &apos;./components/FooterGuide/FooterGuide.vue&apos;</span><br><span class="line">// 引入底部组件并注册</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    FooterGuide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;</span><br><span class="line">// 整个应用组件的样式</span><br><span class="line">  #app</span><br><span class="line">    width 100%</span><br><span class="line">    height 100%</span><br><span class="line">    background #f5f5f5</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ul><li>App.vue里的根元素<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>与外层被注入框架index.html中的<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>是一致的</li><li>index.html中的<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>是指定绑定目标为元素的根路径，而App.vue文件里的<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>则是提供注入绑定元素的内容，两者在运行时指的是同一个DOM元素</li></ul><h3 id="7-5-运行并请求不同路由路径查看效果"><a href="#7-5-运行并请求不同路由路径查看效果" class="headerlink" title="7.5 运行并请求不同路由路径查看效果"></a>7.5 运行并请求不同路由路径查看效果</h3><p>通过切换url地址里的hash值（miste/order/search/profile），页面会显示不同的路由模板内容。</p><h2 id="8-编写组件代码"><a href="#8-编写组件代码" class="headerlink" title="8. 编写组件代码"></a>8. 编写组件代码</h2><h3 id="8-1-FooterGuide组件"><a href="#8-1-FooterGuide组件" class="headerlink" title="8.1 FooterGuide组件"></a>8.1 FooterGuide组件</h3><p><strong>功能及实现</strong></p><ol><li>通过编程式导航实现路由的切换显示($router)</li><li>通过动态 class 和$route.path 来实现 tab 样式切换</li><li>通过阿里图标库, 显示导航图标</li></ol><p><strong>代码</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"footer_guide border-1px"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"guide_item on"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"item_icon"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-food"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>外卖<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--其他三部分类似--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang="stylus" rel="stylesheet/stylus"&gt;</span><br><span class="line"><span class="comment">/*引入公共样式*/</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"../../common/stylus/mixins.styl"</span></span><br><span class="line">.footer_guide</span><br><span class="line">  /*顶部有白色的边框*/</span><br><span class="line">  top-border-<span class="number">1px</span>(#e4e4e4)</span><br><span class="line">  position fixed</span><br><span class="line">  z-index <span class="number">100</span></span><br><span class="line">  left <span class="number">0</span></span><br><span class="line">  right <span class="number">0</span></span><br><span class="line">  bottom <span class="number">0</span></span><br><span class="line">  background-color #fff</span><br><span class="line">  width <span class="number">100%</span></span><br><span class="line">  height <span class="number">50px</span></span><br><span class="line">  display flex</span><br><span class="line">  .guide_item</span><br><span class="line">    display flex</span><br><span class="line">    flex <span class="number">1</span></span><br><span class="line">    text-align center</span><br><span class="line">    flex-direction column</span><br><span class="line">    align-items center</span><br><span class="line">    margin <span class="number">5px</span></span><br><span class="line">    color #<span class="number">999999</span></span><br><span class="line">    &amp;.on</span><br><span class="line">      color #<span class="number">02</span>a774</span><br><span class="line">    span</span><br><span class="line">      font-size <span class="number">12px</span></span><br><span class="line">      margin-top <span class="number">2px</span></span><br><span class="line">      margin-bottom <span class="number">2px</span></span><br><span class="line">      .iconfont</span><br><span class="line">        font-size <span class="number">22px</span></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>此时，页面已达到理想效果。接着修改template模板，为其加入路由与样式的切换控制。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"guide_item"</span> @<span class="attr">click</span>=<span class="string">"goto('/msite')"</span> <span class="attr">:class</span>=<span class="string">"&#123;on: isCurrent('/msite')&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"item_icon"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-food"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--其他三个部分类似，只是路由不同--&gt;</span></span><br></pre></td></tr></table></figure><p>再补充相应的函数方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    goto (path) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$router.replace(path)</span><br><span class="line">    &#125;,</span><br><span class="line">    isCurrent (path) &#123;</span><br><span class="line">      <span class="comment">// console.log(this.$route.path)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$route.path === path</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，底部组件完成，可实现点击不同的选项切换不同的路由组件。</p><h3 id="8-2-各导航路由组件"><a href="#8-2-各导航路由组件" class="headerlink" title="8.2 各导航路由组件"></a>8.2 各导航路由组件</h3><h4 id="8-2-1-Msite组件"><a href="#8-2-1-Msite组件" class="headerlink" title="8.2.1 Msite组件"></a>8.2.1 Msite组件</h4><p><strong>功能区域划分</strong></p><ol><li>最顶部的title标题栏部分</li><li>上方的nav轮播区域</li><li>商家列表展示区域</li></ol><p><strong>图片资源</strong></p><p>Msite组件页面的轮播图及商家列表都需要用到一些图片资源文件，所以在msite.vue同级目录下新建images文件夹，以便放置各种不同类型的图片资源。</p><p><strong>代码</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;section class=&quot;msite&quot;&gt;</span><br><span class="line">    &lt;!--首页头部title--&gt;</span><br><span class="line">    &lt;!--由msite_header改成header--&gt;</span><br><span class="line">    &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;header_search&quot;&gt;</span><br><span class="line">        &lt;i class=&quot;iconfont icon-sousuo&quot;&gt;&lt;/i&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span class=&quot;header_title&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;header_title_text ellipsis&quot;&gt;芝罘区鲁东大学北区(青年南路)&lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span class=&quot;header_login&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;header_login_text&quot;&gt;登录|注册&lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;!--首页导航轮播--&gt;</span><br><span class="line">    &lt;nav class=&quot;msite_nav&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;swiper-container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-wrapper&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;swiper-slide&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;javascript:&quot; class=&quot;link_to_food&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;food_container&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;./images/nav/1.jpg&quot;&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;span&gt;甜品饮品&lt;/span&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">            &lt;a href=&quot;javascript:&quot; class=&quot;link_to_food&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;food_container&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;./images/nav/2.jpg&quot;&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;span&gt;商超便利&lt;/span&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">           &lt;!--下面的图片省略--&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;swiper-slide&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;javascript:&quot; class=&quot;link_to_food&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;food_container&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;./images/nav/9.jpg&quot;&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;span&gt;甜品饮品&lt;/span&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">            &lt;!--同样省略--&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 轮播图页码 --&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-pagination&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">    &lt;!--首页附近商家列表--&gt;</span><br><span class="line">    &lt;div class=&quot;msite_shop_list&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;shop_header&quot;&gt;</span><br><span class="line">        &lt;i class=&quot;iconfont icon-xuanxiang&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;span class=&quot;shop_header_title&quot;&gt;附近商家&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;shop_container&quot;&gt;</span><br><span class="line">        &lt;ul class=&quot;shop_list&quot;&gt;</span><br><span class="line">          &lt;li class=&quot;shop_li border-1px&quot;&gt;</span><br><span class="line">            &lt;a&gt;</span><br><span class="line">              &lt;div class=&quot;shop_left&quot;&gt;</span><br><span class="line">                &lt;img class=&quot;shop_img&quot; src=&quot;./images/shop/1.jpg&quot;&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;shop_right&quot;&gt;</span><br><span class="line">                &lt;section class=&quot;shop_detail_header&quot;&gt;</span><br><span class="line">                  &lt;h4 class=&quot;shop_title ellipsis&quot;&gt;锄禾日当午，汗滴禾下土&lt;/h4&gt;</span><br><span class="line">                  &lt;ul class=&quot;shop_detail_ul&quot;&gt;</span><br><span class="line">                    &lt;li class=&quot;supports&quot;&gt;保&lt;/li&gt;</span><br><span class="line">                    &lt;li class=&quot;supports&quot;&gt;准&lt;/li&gt;</span><br><span class="line">                    &lt;li class=&quot;supports&quot;&gt;票&lt;/li&gt;</span><br><span class="line">                  &lt;/ul&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">                &lt;section class=&quot;shop_rating_order&quot;&gt;</span><br><span class="line">                  &lt;section class=&quot;shop_rating_order_left&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;star star-24&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;star-item half&quot;&gt;&lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;star-item off&quot;&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;rating_section&quot;&gt;</span><br><span class="line">                      3.6</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;order_section&quot;&gt;</span><br><span class="line">                      月售106单</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                  &lt;section class=&quot;shop_rating_order_right&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;delivery_style delivery_right&quot;&gt;硅谷专送&lt;/span&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">                &lt;section class=&quot;shop_distance&quot;&gt;</span><br><span class="line">                  &lt;p class=&quot;shop_delivery_msg&quot;&gt;</span><br><span class="line">                    &lt;span&gt;¥20起送&lt;/span&gt;</span><br><span class="line">                    &lt;span class=&quot;segmentation&quot;&gt;/&lt;/span&gt;</span><br><span class="line">                    &lt;span&gt;配送费约¥5&lt;/span&gt;</span><br><span class="line">                  &lt;/p&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;!--省略其他店铺展示--&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;!--省略js--&gt;</span><br></pre></td></tr></table></figure><p><strong>要注意首页的头部标题部分的样式，在其他的组件中都可以进行重用。</strong>所以将header标签的类名由msite_header改成header。接下来在其他组件中可以直接使用（当然header里的部分样式其他组件用不到，到时再进一步抽取公共的css样式。）</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang="stylus" rel="stylesheet/stylus"&gt;</span><br><span class="line">  @<span class="keyword">import</span> <span class="string">"../../common/stylus/mixins.styl"</span></span><br><span class="line">  .msite  //首页</span><br><span class="line">    width <span class="number">100%</span></span><br><span class="line">    .header</span><br><span class="line">      background-color #<span class="number">02</span>a774</span><br><span class="line">      position fixed</span><br><span class="line">      z-index <span class="number">100</span></span><br><span class="line">      left <span class="number">0</span></span><br><span class="line">      top <span class="number">0</span></span><br><span class="line">      width <span class="number">100%</span></span><br><span class="line">      height <span class="number">45px</span></span><br><span class="line">      .header_search</span><br><span class="line">        position absolute</span><br><span class="line">        left <span class="number">15px</span></span><br><span class="line">        top <span class="number">50%</span></span><br><span class="line">        transform translateY(-<span class="number">50%</span>)</span><br><span class="line">        width <span class="number">10%</span></span><br><span class="line">        height <span class="number">50%</span></span><br><span class="line">        .icon-sousuo</span><br><span class="line">          font-size <span class="number">25px</span></span><br><span class="line">          color #fff</span><br><span class="line">      .header_title</span><br><span class="line">        position absolute</span><br><span class="line">        top <span class="number">50%</span></span><br><span class="line">        left <span class="number">50%</span></span><br><span class="line">        transform translate(-<span class="number">50%</span>, -<span class="number">50%</span>)</span><br><span class="line">        width <span class="number">50%</span></span><br><span class="line">        color #fff</span><br><span class="line">        text-align center</span><br><span class="line">        .header_title_text</span><br><span class="line">          font-size <span class="number">20px</span></span><br><span class="line">          color #fff</span><br><span class="line">          display block</span><br><span class="line">      .header_login</span><br><span class="line">        font-size <span class="number">14px</span></span><br><span class="line">        color #fff</span><br><span class="line">        position absolute</span><br><span class="line">        right <span class="number">15px</span></span><br><span class="line">        top <span class="number">50%</span></span><br><span class="line">        transform translateY(-<span class="number">50%</span>)</span><br><span class="line">        .header_login_text</span><br><span class="line">          color #fff</span><br><span class="line">      /*下面的样式省略*/</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>接下来的几个路由组件都类似，都是先修改template模版，然后引入mixins.styl 样式文件和上面提到的公共的header部分的样式。</p><h4 id="8-2-2-Search组件"><a href="#8-2-2-Search组件" class="headerlink" title="8.2.2 Search组件"></a>8.2.2 Search组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;section class=&quot;search&quot;&gt;</span><br><span class="line">    &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;header_title&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;header_title_text&quot;&gt;搜索&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;form class=&quot;search_form&quot; action=&quot;#&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;search&quot; name=&quot;search&quot; placeholder=&quot;请输入商家或美食名称&quot;</span><br><span class="line">    class=&quot;search_input&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot; class=&quot;search_submit&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;!--省略js与style--&gt;</span><br></pre></td></tr></table></figure><h4 id="8-2-3-Order组件"><a href="#8-2-3-Order组件" class="headerlink" title="8.2.3 Order组件"></a>8.2.3 Order组件</h4><p>在order.vue同级目录下新建images文件夹，再新建order文件夹，存放订单组件用到的图片资源。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;section class=&quot;order&quot;&gt;</span><br><span class="line">    &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;header_title&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;header_title_text&quot;&gt;订单列表&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;section class=&quot;order_no_login&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;./images/order/person.png&quot;&gt;</span><br><span class="line">        &lt;h3&gt;登录后查看外卖订单&lt;/h3&gt;</span><br><span class="line">      &lt;button&gt;立即登陆&lt;/button&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--省略js与style--&gt;</span><br></pre></td></tr></table></figure><h4 id="8-2-4-Profile组件"><a href="#8-2-4-Profile组件" class="headerlink" title="8.2.4 Profile组件"></a>8.2.4 Profile组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;section class=&quot;profile&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;header_title&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;header_title_text&quot;&gt;我的&lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;section class=&quot;profile-number&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; class=&quot;profile-link&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;profile_image&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-yonghuming&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;user-info&quot;&gt;</span><br><span class="line">            &lt;p class=&quot;user-info-top&quot;&gt;登录/注册&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">              &lt;span class=&quot;user-icon&quot;&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-msnui-tel icon-mobile&quot;&gt;&lt;/i&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">              &lt;span class=&quot;icon-mobile-number&quot;&gt;暂无绑定手机号&lt;/span&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;span class=&quot;arrow&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-previewright&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;section class=&quot;profile_info_data border-1px&quot;&gt;</span><br><span class="line">        &lt;ul class=&quot;info_data_list&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;javascript:&quot; class=&quot;info_data_link&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_top&quot;&gt;&lt;span&gt;0.00&lt;/span&gt;元&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_bottom&quot;&gt;我的余额&lt;/span&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">          &lt;a href=&quot;javascript:&quot; class=&quot;info_data_link&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_top&quot;&gt;&lt;span&gt;0&lt;/span&gt;个&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_bottom&quot;&gt;我的优惠&lt;/span&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">          &lt;a href=&quot;javascript:&quot; class=&quot;info_data_link&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_top&quot;&gt;&lt;span&gt;0&lt;/span&gt;分&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;info_data_bottom&quot;&gt;我的积分&lt;/span&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;section class=&quot;profile_my_order border-1px&quot;&gt;</span><br><span class="line">        &lt;!-- 我的订单 --&gt;</span><br><span class="line">        &lt;a href=&apos;javascript:&apos; class=&quot;my_order&quot;&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-dingdan&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;div class=&quot;my_order_div&quot;&gt;</span><br><span class="line">            &lt;span&gt;我的订单&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;my_order_icon&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-previewright&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        &lt;!-- 积分商城 --&gt;</span><br><span class="line">        &lt;a href=&apos;javascript:&apos; class=&quot;my_order&quot;&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-jifen&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;div class=&quot;my_order_div&quot;&gt;</span><br><span class="line">            &lt;span&gt;积分商城&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;my_order_icon&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-previewright&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        &lt;!-- Mint外卖会员卡 --&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; class=&quot;my_order&quot;&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-viptehuishiduan&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;div class=&quot;my_order_div&quot;&gt;</span><br><span class="line">            &lt;span&gt;Mint外卖会员卡&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;my_order_icon&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-previewright&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;section class=&quot;profile_my_order border-1px&quot;&gt;</span><br><span class="line">        &lt;!-- 服务中心 --&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:&quot; class=&quot;my_order&quot;&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-lianxikefu&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;div class=&quot;my_order_div&quot;&gt;</span><br><span class="line">            &lt;span&gt;服务中心&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;my_order_icon&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-previewright&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;!--省略js与style--&gt;</span><br></pre></td></tr></table></figure><h3 id="8-3-HeaderTop组件"><a href="#8-3-HeaderTop组件" class="headerlink" title="8.3 HeaderTop组件"></a>8.3 HeaderTop组件</h3><h4 id="8-3-1组件的构成分析"><a href="#8-3-1组件的构成分析" class="headerlink" title="8.3.1组件的构成分析"></a>8.3.1组件的构成分析</h4><ol><li>中间有一个固定的标题栏，只是用在不同的路由组件中显示的内容不同</li><li>标题栏两侧可能有搜索框之类的部分（Msite）也可能没有</li><li>此组件为非路由组件的公用组件（所以在Components文件夹内）</li></ol><h4 id="8-3-2-功能实现的技术"><a href="#8-3-2-功能实现的技术" class="headerlink" title="8.3.2 功能实现的技术"></a>8.3.2 功能实现的技术</h4><ul><li>标题栏两侧是否有其他部分，要用到slot插槽进行组件间通信</li><li>slot 通信是标签, 而不是单纯的数据</li><li>中间标题栏接收的文本可以用props</li></ul><h4 id="8-3-3-组件代码"><a href="#8-3-3-组件代码" class="headerlink" title="8.3.3 组件代码"></a>8.3.3 组件代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">    &lt;!-- 插槽是父组件与子组件的通讯方式，子组件中的slot可以显示父组件传递给子组件的内容 --&gt;</span><br><span class="line">    &lt;slot name=&quot;left&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;span class=&quot;header_title&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;header_title_text ellipsis&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">    &lt;slot name=&quot;right&quot;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    // 外部组件传递给此组件的属性</span><br><span class="line">    props: &#123;</span><br><span class="line">      title: String</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="8-3-4-在路由组件中使用"><a href="#8-3-4-在路由组件中使用" class="headerlink" title="8.3.4 在路由组件中使用"></a>8.3.4 在路由组件中使用</h4><ul><li>在要使用此头部组件的文件中引入并注册HeaderTop组件</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Msite、Order、Search、Profile中都要引入注册才能使用</span></span><br><span class="line"><span class="keyword">import</span> HeaderTop <span class="keyword">from</span> <span class="string">'../../components/HeaderTop/HeaderTop.vue'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    HeaderTop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>然后使用<code>&lt;HeaderTop&gt;&lt;/HeaderTop&gt;</code>标签设置这个头部组件</p><blockquote><p>这里以Msite.vue为例，先删除静态模版里的Header部分，替换成HeaderTop组件</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用 title 来给头部组件传递数据 --&gt;</span><br><span class="line">&lt;HeaderTop title=&quot;芝罘区鲁东大学北区(青年南路)&quot;&gt;</span><br><span class="line">  &lt;!-- 要使用slot=&quot;left&quot;指定插入的插槽位置 --&gt;</span><br><span class="line">  &lt;span class=&quot;header_search&quot; slot=&quot;left&quot;&gt;</span><br><span class="line">    &lt;i class=&quot;iconfont icon-sousuo&quot;&gt;&lt;/i&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">  &lt;span class=&quot;header_login&quot; slot=&quot;right&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;header_login_text&quot;&gt;</span><br><span class="line">          登录|注册</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/span&gt;</span><br><span class="line">&lt;/HeaderTop&gt;</span><br></pre></td></tr></table></figure><ul><li>在其他几个组件中的用法是一样的，同时还省去了slot插槽部分。</li></ul><h3 id="8-4-使用swiper插件实现轮播图"><a href="#8-4-使用swiper插件实现轮播图" class="headerlink" title="8.4 使用swiper插件实现轮播图"></a>8.4 使用swiper插件实现轮播图</h3><p><strong>下载安装：</strong> <code>npm install swiper --save</code></p><p><strong>Msite.vue的HTML部分：</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在页面msite_nav导航部分使用swiper--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-container"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- swiper轮播图圆点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-pagination"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>script部分引入并初始化：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">'swiper'</span></span><br><span class="line"><span class="comment">//同时引入swiper的 css文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'swiper/dist/css/swiper.min.css'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//注意要在页面加载完成之后（mounted）再进行swiper的初始化</span></span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="comment">//创建一个swiper实例来实现轮播</span></span><br><span class="line">    <span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">      autoplay: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 如果需要分页器</span></span><br><span class="line">      pagination: &#123;</span><br><span class="line">        el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">        clickable: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong>具体用法参考</strong><a href="http://www.swiper.com.cn/api/" target="_blank" rel="noopener">Swiper官方文档</a></p><h3 id="8-5-拆分出商家列表ShopList组件"><a href="#8-5-拆分出商家列表ShopList组件" class="headerlink" title="8.5 拆分出商家列表ShopList组件"></a>8.5 拆分出商家列表ShopList组件</h3><ol><li>商家列表是位于首页轮播图下面的部分，可以拆分为一般组件</li><li>在components文件夹下新建ShopList文件夹并新建ShopList.vue文件</li><li>该组件中用到需要一些图片资源，所以在ShopList文件夹下还需要新建images文件夹</li><li>将原本放在Msite文件夹下的shop和stars图片资源移动到新建的images文件夹内 (其实都应该是动态地从后台获取)</li><li>将Msite.vue模板中的<code>&lt;div class=&quot;shop_container&quot;&gt;&lt;/div&gt;</code>部分及相应的stylus样式代码移动到新建的ShopList.vue组件</li><li>注意还要引入公共的css代码mixins.styl</li><li>最后在Msite.vue中import引入商家列表组件并注册使用</li></ol><h3 id="8-6-Login组件"><a href="#8-6-Login组件" class="headerlink" title="8.6 Login组件"></a>8.6 Login组件</h3><p><strong>资源文件准备</strong></p><ol><li>登录组件为一级路由组件，所以在pages文件夹下新建Login文件夹和Login.vue</li><li>template模板里会用到一张svg图片(静态的验证码图片)，所以还要在Login文件夹下新建images文件夹</li></ol><p><strong>配置路由跳转</strong></p><ul><li>将路由组件映射为路由，在router下的index.js文件里进行配置</li><li>登录组件的路由是从个人中心Profile组件里跳转而来的，所以要修改Profile.vue</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--将class为profile-link的a标签替换为router-link--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:"</span> <span class="attr">class</span>=<span class="string">"profile-link"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--但要注意不要忘记class类名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/Login"</span> <span class="attr">class</span>=<span class="string">"profile-link"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--先不考虑未登录的情况--&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>编写Login.vue代码</strong></p><ul><li>利用<code>@click=&quot;$router.back()&quot;</code>实现点击页面的箭头返回上一级路由/Profile的功能</li></ul><p><strong>实现控制Footer的显示隐藏</strong></p><ul><li><p>已确定底部的四个路由组件需要显示Footer部分</p></li><li><p>而Login组件为一级路由组件，且不需要显示底部的FooterGuide导航组件</p></li><li><p>所以为路由组件添加meta元数据来标识是否显示Footer</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">'/msite'</span>,</span><br><span class="line">  component: Msite,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    showFooter: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">/*Order、Searh、Profile组件都要添加meta*/</span></span><br></pre></td></tr></table></figure></li><li><p>在App.vue组件中通过代表当前路由的<code>$route</code>就能得到添加的meta属性，然后根据属性值来确定是否显示FooterGuide组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FooterGuide</span> <span class="attr">v-show</span>=<span class="string">"$route.meta.showFooter"</span>&gt;</span><span class="tag">&lt;/<span class="name">FooterGuide</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>其他细节</strong></p><ul><li><p>注意到一个问题，在一个路由组件(Msite)将页面下拉，再切换到其他路由组件(Profile)，页面不会自动回到顶部。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*解决方法 其他页面中类似*/</span></span><br><span class="line"><span class="selector-class">.profile</span></span><br><span class="line">    <span class="attribute">width</span> 100%</span><br><span class="line">	<span class="comment">/*添加一行overflow hidden*/</span></span><br><span class="line">    <span class="attribute">overflow</span> hidden</span><br></pre></td></tr></table></figure></li></ul><h2 id="9-后台应用"><a href="#9-后台应用" class="headerlink" title="9. 后台应用"></a>9. 后台应用</h2><h3 id="9-1-说明"><a href="#9-1-说明" class="headerlink" title="9.1 说明"></a>9.1 说明</h3><ol><li>整个项目为前后端分离的项目：mintshop-client 与 mintshop-server</li><li>后台应用负责处理前台应用提交的请求, 并给前台应用返回 json 数据</li><li>前台应用负责展现数据, 与用户交互, 与后台应用交互</li></ol><h3 id="9-2-运行"><a href="#9-2-运行" class="headerlink" title="9.2 运行"></a>9.2 运行</h3><ol><li>确保启动 mongodb 服务</li><li>进入mintshop-server文件夹，启动服务器应用: <code>npm start</code></li></ol><h3 id="9-3-API文档"><a href="#9-3-API文档" class="headerlink" title="9.3 API文档"></a>9.3 API文档</h3><p><strong>具体API文档详见mintshop-server/API.md，然后可以使用Postman来进行接口测试</strong></p><h2 id="10-前后台交互-ajax"><a href="#10-前后台交互-ajax" class="headerlink" title="10. 前后台交互 ajax"></a>10. 前后台交互 ajax</h2><ul><li>测试完后台接口，则需要写前后台交互的ajax文件</li><li>在src/api文件夹下新建index.js与ajax.js<ul><li>首先需要安装axios <code>npm install axios--save</code></li></ul></li></ul><h3 id="10-1-封装ajax请求函数"><a href="#10-1-封装ajax请求函数" class="headerlink" title="10.1 封装ajax请求函数"></a>10.1 封装ajax请求函数</h3><ul><li>为了实现统一向后端发送请求数据，所以需要封装一个ajax请求函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ajax 请求函数模块</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向外部暴漏一个函数 ajax</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; url 请求路径，默认为空</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; data 请求参数，默认为空对象</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; type 请求方法，默认为GET</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">url = <span class="string">''</span>, data = &#123;&#125;, type = <span class="string">'GET'</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 返回值 Promise对象 （异步返回的数据是response.data，而不是response）</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//（利用axios）异步执行ajax请求</span></span><br><span class="line">    <span class="keyword">let</span> promise <span class="comment">// 这个内部的promise用来保存axios的返回值(promise对象)</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'GET'</span>) &#123;</span><br><span class="line">      <span class="comment">// 准备 url query 参数数据</span></span><br><span class="line">      <span class="keyword">let</span> dataStr = <span class="string">''</span> <span class="comment">// 数据拼接字符串，将data连接到url</span></span><br><span class="line">      <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        dataStr += key + <span class="string">'='</span> + data[key] + <span class="string">'&amp;'</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (dataStr !== <span class="string">''</span>) &#123;</span><br><span class="line">        dataStr = dataStr.substring(<span class="number">0</span>, dataStr.lastIndexOf(<span class="string">'&amp;'</span>))</span><br><span class="line">        url = url + <span class="string">'?'</span> + dataStr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 发送 get 请求</span></span><br><span class="line">      promise = axios.get(url)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 发送 post 请求</span></span><br><span class="line">      promise = axios.post(url, data)</span><br><span class="line">    &#125;</span><br><span class="line">    promise.then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 成功回调resolve()</span></span><br><span class="line">        resolve(response.data)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 失败回调reject()</span></span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过对axios返回的promise对象再包装一层Promise的方法，来简化外部的调用</li></ul><h3 id="10-2-封装接口请求函数"><a href="#10-2-封装接口请求函数" class="headerlink" title="10.2 封装接口请求函数"></a>10.2 封装接口请求函数</h3><ul><li>有了发送请求数据的ajax函数，还需要封装一些与后台交互的接口函数</li><li>根据接口文档来定义接口请求函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*与后台交互模块 （依赖已封装的ajax函数）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">'./ajax'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取地址信息(根据经纬度串)</span></span><br><span class="line"><span class="comment"> * 这个接口的经纬度参数是在url路径里的，没有query参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddress = <span class="function"><span class="params">geohash</span> =&gt;</span> ajax(<span class="string">`/position/<span class="subst">$&#123;geohash&#125;</span>`</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 msite 页面食品分类列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/index_category'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 msite 商铺列表(根据query参数：经纬度)</span></span><br><span class="line"><span class="comment"> * 将经纬度两个数据作为一个参数对象传入</span></span><br><span class="line"><span class="comment"> * 也可以两个数据分别传入ajax， 然后再放入一个对象参数内， 如下面的手机号验证码接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqShops = (&#123;</span><br><span class="line">  latitude,</span><br><span class="line">  longitude</span><br><span class="line">&#125;) =&gt; ajax(<span class="string">'/shops'</span>, &#123;</span><br><span class="line">  latitude,</span><br><span class="line">  longitude</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账号密码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqPwdLogin = <span class="function">(<span class="params">name, pwd, captcha</span>) =&gt;</span> ajax(<span class="string">'/login_pwd'</span>, &#123;</span><br><span class="line">  name,</span><br><span class="line">  pwd,</span><br><span class="line">  captcha</span><br><span class="line">&#125;, <span class="string">'POST'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取短信验证码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqSendCode = <span class="function"><span class="params">phone</span> =&gt;</span> ajax(<span class="string">'/sendcode'</span>, &#123;</span><br><span class="line">  phone</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手机号验证码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqSmsLogin = <span class="function">(<span class="params">phone, code</span>) =&gt;</span> ajax(<span class="string">'/login_sms'</span>, &#123;</span><br><span class="line">  phone,</span><br><span class="line">  code</span><br><span class="line">&#125;, <span class="string">'POST'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户信息(根据会话)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqUser = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/userinfo'</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 请求登出</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqLogout = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/logout'</span>)</span><br></pre></td></tr></table></figure><h3 id="10-3-配置代理并测试接口实现ajax跨域请求"><a href="#10-3-配置代理并测试接口实现ajax跨域请求" class="headerlink" title="10.3 配置代理并测试接口实现ajax跨域请求"></a>10.3 配置代理并测试接口实现ajax跨域请求</h3><p><strong>问题分析：</strong></p><ul><li><p>目前为止运行的所有页面都是静态页面</p></li><li><p>接下来先测试使用封装的ajax接口请求函数来异步获取数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先在App.vue中引入封装的接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqCategorys&#125; <span class="keyword">from</span> <span class="string">'./api'</span></span><br><span class="line"><span class="comment">// 然后再调用接口，测试打印数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys()</span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    FooterGuide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>打开浏览器，运行项目会报错<code>GET http://local:4000/index_category 404(Not Found)</code></p></li><li><p>此时想起后端API端口为4000，然后在api文件夹下的index.js中修改测试</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义BASE_URL</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="string">'http://local:4000'</span></span><br><span class="line"><span class="comment">// 然后修改请求接口的url</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys = <span class="function"><span class="params">()</span> =&gt;</span> ajax(BASE_URL + <span class="string">'/index_category'</span>)</span><br></pre></td></tr></table></figure></li><li><p>然后再打开项目，发现依然报错<code>access-control-allow-origin</code>提示请求为跨域请求</p></li></ul><p><strong>配置代理并测试接口：</strong></p><ul><li>除了设置让服务器允许跨域的方法之外，还可以通过配置代理实现跨域请求</li></ul><ol><li><p>在项目config文件夹下的index.js文件里设置代理配置表</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Paths</span></span><br><span class="line"><span class="comment">// 静态资源文件夹</span></span><br><span class="line">assetsSubDirectory: <span class="string">'static'</span>,</span><br><span class="line"><span class="comment">// 发布路径</span></span><br><span class="line">assetsPublicPath: <span class="string">'/'</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理配置表，在这里可以配置特定的请求代理到对应的API接口</span></span><br><span class="line"><span class="comment">// 例如将'localhost:8080/api/xxx'代理到'www.example.com/api/xxx'</span></span><br><span class="line">proxyTable: &#123;</span><br><span class="line">  <span class="string">'/api'</span>: &#123; <span class="comment">// 匹配所有以 '/api'开头的请求路径</span></span><br><span class="line">  	target: <span class="string">'http://localhost:4000'</span>, <span class="comment">// 代理目标的基础路径</span></span><br><span class="line">    <span class="comment">// secure: false,  // 如果是https接口，需要配置这个参数</span></span><br><span class="line">    changeOrigin: <span class="literal">true</span>, <span class="comment">// 支持跨域</span></span><br><span class="line">    pathRewrite: &#123; <span class="comment">// 重写路径: 去掉路径中开头的'/api'</span></span><br><span class="line">      <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>修改api文件夹index.js里接口函数的请求路径</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const BASE_URL = 'http://local:4000'</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="string">'/api'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddress = <span class="function"><span class="params">geohash</span> =&gt;</span> ajax(<span class="string">`<span class="subst">$&#123;BASE_URL&#125;</span>/position/<span class="subst">$&#123;geohash&#125;</span>`</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys = <span class="function"><span class="params">()</span> =&gt;</span> ajax(BASE_URL + <span class="string">'/index_category'</span>)</span><br><span class="line"><span class="comment">// 下面修改后的接口省略...</span></span><br></pre></td></tr></table></figure></li><li><p>因为修改了项目的config文件，所以需要重启项目<code>npm run dev</code></p></li><li><p>此时可以在控制台看到跨域请求到的数据<code>{code: 0, data: Array(16)}</code></p></li></ol><h2 id="11-使用Vuex管理状态"><a href="#11-使用Vuex管理状态" class="headerlink" title="11. 使用Vuex管理状态"></a>11. 使用Vuex管理状态</h2><ul><li>安装Vuex<code>npm install vuex --save</code>用来管理从后台获取的状态数据</li><li>以下代码以首页Msite为例</li></ul><h3 id="11-1-创建Store-核心仓库"><a href="#11-1-创建Store-核心仓库" class="headerlink" title="11.1 创建Store(核心仓库)"></a>11.1 创建Store(核心仓库)</h3><ul><li>在项目的store文件夹下新建index.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">vuex最核心的管理对象store</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 首先引入Vue及Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入四个基本模块</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">'./state'</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations'</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一定要声明使用插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="11-2-模块对象"><a href="#11-2-模块对象" class="headerlink" title="11.2 模块对象"></a>11.2 模块对象</h3><h4 id="11-2-1-State"><a href="#11-2-1-State" class="headerlink" title="11.2.1 State"></a>11.2.1 State</h4><ul><li>分析整理出项目首页Msite中有哪些状态需要管理，然后写入state.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">状态对象 state</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  latitude: <span class="number">40.10038</span>, <span class="comment">// 纬度</span></span><br><span class="line">  longitude: <span class="number">116.36867</span>, <span class="comment">// 经度</span></span><br><span class="line">  address: &#123;&#125;, <span class="comment">// 地址相关信息对象</span></span><br><span class="line">  categorys: [], <span class="comment">// 食品分类数组</span></span><br><span class="line">  shops: [] <span class="comment">// 商家数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-2-2-Mutation"><a href="#11-2-2-Mutation" class="headerlink" title="11.2.2 Mutation"></a>11.2.2 Mutation</h4><ul><li><p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation</p></li><li><p>每个 mutation 都有一个字符串的 <strong>事件类型 (type)</strong> 和 一个 <strong>回调函数 (handler)</strong></p></li><li><p>我们可以使用常量替代 Mutation 事件类型，新建<strong>mutations-types文件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">包含n个mutation的type名称常量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_ADDRESS = <span class="string">'receive_address'</span> <span class="comment">// 接收地址信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_CATEGORYS = <span class="string">'receive_categorys'</span> <span class="comment">// 接收分类数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_SHOPS = <span class="string">'receive_shops'</span> <span class="comment">// 接收商家数组</span></span><br></pre></td></tr></table></figure></li><li><p>然后在mutations.js文件内引入使用<strong>(注意书写格式)</strong></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">vuex 的 mutations 模块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> &#123;RECEIVE_ADDRESS,RECEIVE_CATEGORYS,RECEIVE_SHOPS&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [方法名](state,&#123;param&#125;)&#123;&#125;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	[RECEIVE_ADDRESS](state, &#123;address&#125;) &#123;</span><br><span class="line">		state.address = address</span><br><span class="line">	&#125;,</span><br><span class="line">	[RECEIVE_CATEGORYS](state, &#123;categorys&#125;) &#123;</span><br><span class="line">		state.categorys = categorys</span><br><span class="line">	&#125;,</span><br><span class="line">	[RECEIVE_SHOPS](state, &#123;shops&#125;) &#123;</span><br><span class="line">		state.shops = shops</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>而回调函数就是我们实际进行状态更改的地方，并且它会接受 state 作为第一个参数</li></ul><h4 id="11-2-3-Action"><a href="#11-2-3-Action" class="headerlink" title="11.2.3 Action"></a>11.2.3 Action</h4><p>Action 类似于 mutation，不同在于：</p><ul><li><p>Action 提交的是 mutation，而不是直接变更状态。</p></li><li><p>Action 可以包含任意异步操作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Action:通过操作mutation间接更新state的多个方法的对象</span></span><br><span class="line"><span class="comment">// 注意要引入api接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqAddress, reqCategorys, reqShops&#125; <span class="keyword">from</span> <span class="string">'../api'</span></span><br><span class="line"><span class="keyword">import</span> &#123;RECEIVE_ADDRESS, RECEIVE_CATEGORYS, RECEIVE_SHOPS&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 异步获取地址</span></span><br><span class="line">  <span class="keyword">async</span> getAddress (&#123;commit, state&#125;) &#123;</span><br><span class="line">    <span class="comment">// 从state状态中获取到经纬度用来设置reqAddress的参数（看接口文档）</span></span><br><span class="line">    <span class="keyword">const</span> geohash = state.latitude + <span class="string">','</span> + state.longitude</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 发送异步ajax请求</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddress(geohash)</span><br><span class="line">    <span class="comment">// 2. 根据结果提交一个mutation</span></span><br><span class="line">    commit(RECEIVE_ADDRESS, &#123;<span class="attr">address</span>: result.data&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 异步获取分类列表</span></span><br><span class="line">  <span class="keyword">async</span> getCategorys (&#123;commit&#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys()</span><br><span class="line">    commit(RECEIVE_CATEGORYS, &#123;<span class="attr">categorys</span>: result.data&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 异步获取商家列表</span></span><br><span class="line">  <span class="keyword">async</span> getShops (&#123;commit, state&#125;) &#123;</span><br><span class="line">    <span class="comment">// 对象的解构赋值</span></span><br><span class="line">    <span class="keyword">const</span> &#123;latitude, longitude&#125; = state</span><br><span class="line">    <span class="comment">// 注意参数的顺序</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqShops(&#123;latitude, longitude&#125;)</span><br><span class="line">    commit(RECEIVE_SHOPS, &#123;<span class="attr">shops</span>: result.data&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>至此已经完成了首页状态数据的vuex设置</p></li></ul><h3 id="11-3-异步获取并显示数据"><a href="#11-3-异步获取并显示数据" class="headerlink" title="11.3 异步获取并显示数据"></a>11.3 异步获取并显示数据</h3><ol><li><p>在项目中注册store</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//项目的main.js文件</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	store</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>测试异步<strong>获取</strong>当前地址数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 地址信息要尽早的获取，所以请求可以写在App.vue中</span></span><br><span class="line"><span class="comment">// 首先删除之前测试使用封装的ajax接口的代码</span></span><br><span class="line"><span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="comment">// 通过this.$store.dispatch 方法触发调用Action</span></span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getAddress'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>运行项目，在浏览器控制台里打开vue开发工具，切换到vuex，可以看到通过vuex异步获取的状态数据</li><li>除了这种方法调用action，还可以使用mapActions语法糖</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapActions&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="keyword">this</span>.getAddress()</span><br><span class="line">&#125;</span><br><span class="line">methods: &#123;</span><br><span class="line">	...mapActions([<span class="string">'getAddress'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>读取</strong>并显示获取到的当前地址数据</p><ul><li>首页Msite组件中显示地址信息</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用mapState语法糖去读取state对象</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">computed: &#123;</span><br><span class="line">	...mapState([<span class="string">'address'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;HeaderTop :title=<span class="string">"address.name"</span>&gt;</span><br><span class="line"><span class="comment">// 将静态地址信息换成异步获取的地址数据 注意:title为绑定数据</span></span><br><span class="line">&lt;<span class="regexp">/HeaderTop&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="12-完成Msite页面"><a href="#12-完成Msite页面" class="headerlink" title="12. 完成Msite页面"></a>12. 完成Msite页面</h2><h3 id="12-1-异步显示食品分类轮播列表"><a href="#12-1-异步显示食品分类轮播列表" class="headerlink" title="12.1 异步显示食品分类轮播列表"></a>12.1 异步显示食品分类轮播列表</h3><ul><li>上面已经完成了首页当前地址信息的获取与显示，接下来是完成Msite.vue中的食品分类的轮播图</li></ul><ol><li><p>mounted方法中通过this.$store.dispatch调用Action来获取异步数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 忘记Actuon里对应的方法名时查看Action.js</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getCategorys'</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过mapState语法糖来读取获取到的异步数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 忘记state名时查看State.js</span></span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapState([<span class="string">'address'</span>, <span class="string">'categorys'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>分析template结构并处理categorys数据</p><blockquote><p>业务分析： 此时获取到的categorys是所有食品类别的一维数组，而如果要完成轮播图，需要将其变成这种<code>[[page1], [page2], [page3]]</code>二维数组categorysArr。</p><p>比如本项目中有两页轮播图，一页为8个数据。应该把categorys数组处理成<code>[[data1 - 8], [data1 - 8]]</code>这种数据格式</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//template</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span> <span class="attr">v-for</span>=<span class="string">"(pages,index) in categorysArr"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:"</span> <span class="attr">class</span>=<span class="string">"(data,index) in pages"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>利用计算属性将categorys处理成期望的数据结构categorysArr</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">computed () &#123;</span><br><span class="line">    ...mapState([<span class="string">'address'</span>, <span class="string">'categorys'</span>]),</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    根据categorys一维数组生成一个2维数组</span></span><br><span class="line"><span class="comment">    小数组中的元素个数最大是8</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    categorysArr () &#123;</span><br><span class="line">      <span class="comment">// 1.先从当前组件中得到所有食品分类的一维数组</span></span><br><span class="line">      <span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">// 2.准备一个空的二维数组--categorysArr</span></span><br><span class="line">      <span class="keyword">const</span> arr = []</span><br><span class="line">      <span class="comment">// 3.准备一个小数组--pages(最大长度为8)</span></span><br><span class="line">      <span class="keyword">let</span> minArr = []</span><br><span class="line">      <span class="comment">// 4.遍历categorys得到处理后的二维数组catagorysArr</span></span><br><span class="line">      categorys.forEach(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果当前小数组(pages)已经满了, 创建一个新的</span></span><br><span class="line">        <span class="keyword">if</span> (minArr.length === <span class="number">8</span>) &#123;</span><br><span class="line">          minArr = []</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果minArr是空的, 将小数组(pages)保存到大数组(categorysArr)中</span></span><br><span class="line">        <span class="keyword">if</span> (minArr.length === <span class="number">0</span>) &#123;</span><br><span class="line">          arr.push(minArr)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将当前分类信息保存到小数组(pages)中</span></span><br><span class="line">        minArr.push(data)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意第4步forEach里的逻辑顺序</p><p>1.为什么当minArr数组的长度为0时就将它与大数组关联起来，不是等它存满(8个)？</p><p>因为有可能categorys里的数据个数不为8的倍数，最后一个minArr内的数据不足8个。</p><p>2.为什么先判断minArr的长度为8的情况再判断等于0的情况？</p><p>因为先判断minArr的长度为0，将其放入大数组中与大数组关联起来，那么等到当前这个minArr填充完成之后新建的小数组则无法与大数组关联起来。</p><p>所以先判断长度为8的情况，再判断数组长度为0的情况。就可以确保之前的minArr填充完成后，新建的minArr都可以被放到大数组里与大数组关联起来。</p></blockquote><ul><li>除了上面的方式处理categorys，也可以采用分割数组的方法。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">categorysArr () &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">this</span></span><br><span class="line">	<span class="keyword">const</span> arr = []</span><br><span class="line"> 	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>,len = categorys.length;i &lt; len; i += <span class="number">8</span>)&#123;</span><br><span class="line">    	arr.push(categorys.slice(i, i + <span class="number">8</span>))</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>将数据显示到页面上</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为食品分类的图片信息都有一个baseImageUrl所以在data里定义</span></span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      baseImageUrl: <span class="string">'https://fuss10.elemecdn.com'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过v-for循环渲染data的信息 注意src为绑定数据--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span> <span class="attr">v-for</span>=<span class="string">"(pages,index) in categorysArr"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:"</span> <span class="attr">class</span>=<span class="string">"link_to_food"</span> <span class="attr">v-for</span>=<span class="string">"(data,index) in pages"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"food_container"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"baseImageUrl+data.image_url"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.title&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="12-2-使用watch与-nextTick解决轮播的Bug"><a href="#12-2-使用watch与-nextTick解决轮播的Bug" class="headerlink" title="12.2 使用watch与$nextTick解决轮播的Bug"></a>12.2 使用watch与$nextTick解决轮播的Bug</h3><ul><li><p>分页器Swiper其实应该是在轮播列表显示(即categorys数组有了数据)以后才初始化。</p></li><li><p>最开始categorys为空数组，有了数据才会显示轮播列表，而要监视categorys的数据变化，就要用到<strong>watch</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建watch 监听categorys</span></span><br><span class="line">watch: &#123;</span><br><span class="line">    categorys (value) &#123; <span class="comment">// categorys数组中有数据了</span></span><br><span class="line">    	<span class="comment">// 但界面还没有异步更新</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除mounted中的new Swiper...代码</span></span><br></pre></td></tr></table></figure></li><li><p>但其实<strong>state里的状态数据改变（categorys接收数据）与异步更新界面（显示轮播列表）是两个步骤</strong>。所以需要等一等，界面完成异步更新后才可以进行Swiper的初始化。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用setTimeout可以实现效果, 但是时机不准确</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个Swiper实例对象, 来实现轮播</span></span><br><span class="line">	<span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">          autoplay: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">            clickable: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br></pre></td></tr></table></figure></li><li><p>利用<code>vm.$nextTick( [callback] )</code>来实现等待界面完成异步更新就立即创建Swiper对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在修改数据之后立即使用它，然后等待 DOM 更新。</span></span><br><span class="line"><span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 一旦完成界面更新, 立即执行回调</span></span><br><span class="line">    <span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">    	autoplay: <span class="literal">true</span>,</span><br><span class="line">    	pagination: &#123;</span><br><span class="line">    	el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">    	clickable: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="12-3-异步显示商家列表"><a href="#12-3-异步显示商家列表" class="headerlink" title="12.3 异步显示商家列表"></a>12.3 异步显示商家列表</h3><ol><li>在Msite的mounted中获取异步数据</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'getShops'</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在ShopList.vue中引入mapState，在computed中读取状态数据</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  	computed: &#123;</span><br><span class="line">		...mapState([<span class="string">'shops'</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改template并添加data</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">      baseImgUrl: <span class="string">'http://owoccema2.bkt.clouddn.com/show/MintShop/'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"shop_li border-1px"</span> <span class="attr">v-for</span>=<span class="string">"(shop,index) in shops"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop_left"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"shop_img"</span> <span class="attr">:src</span>=<span class="string">"baseImgUrl + shop.image_path"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop_right"</span>&gt;</span></span><br><span class="line">     		<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_detail_header"</span>&gt;</span></span><br><span class="line">             	<span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"shop_title ellipsis"</span>&gt;</span>&#123;&#123;shop.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">             	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"shop_detail_ul"</span>&gt;</span></span><br><span class="line">                	...</span><br><span class="line">              	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">         	<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">         	<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_rating_order"</span>&gt;</span></span><br><span class="line">         	<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_rating_order_left"</span>&gt;</span></span><br><span class="line">        	 	...</span><br><span class="line">         	<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="12-4-开发评分Star组件"><a href="#12-4-开发评分Star组件" class="headerlink" title="12.4 开发评分Star组件"></a>12.4 开发评分Star组件</h3><ul><li>不仅在首页的商家列表中有五颗星星的评分部分，商家信息的评价区域也有star评分，所以可以把它抽取成一个可复用的一般组件。</li></ul><ol><li><p>在components文件夹下新建Star文件夹，然后将原本在ShopList文件夹下的images文件夹里的stars移动到新建的Star文件夹里并重命名为images</p></li><li><p>在Star文件夹里新建Star.vue并将ShopList.vue中评分部分的模版和样式剪切进去，注意修改图片路径</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star star-24"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item half"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item off"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>根据类名为组件设置属性props和计算属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类名常量</span></span><br><span class="line"><span class="keyword">const</span> CLASS_ON = <span class="string">'on'</span></span><br><span class="line"><span class="keyword">const</span> CLASS_HALF = <span class="string">'half'</span></span><br><span class="line"><span class="keyword">const</span> CLASS_OFF = <span class="string">'off'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    score: <span class="built_in">Number</span>,</span><br><span class="line">    size: <span class="built_in">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    3.2: 3 + 0 + 2</span></span><br><span class="line"><span class="comment">    4.7: 4 + 1 + 0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 该方法产生一个数组starArr来表示on half off类名的span数量（总长度为5）</span></span><br><span class="line">    starClasses () &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;score&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">const</span> starArr = []</span><br><span class="line">      <span class="comment">// 向starArr中添加n个CLASS_ON</span></span><br><span class="line">      <span class="keyword">const</span> scoreInteger = <span class="built_in">Math</span>.floor(score)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; scoreInteger; i++) &#123;</span><br><span class="line">        starArr.push(CLASS_ON)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 向starArr中添加0/1个CLASS_HALF</span></span><br><span class="line">      <span class="keyword">if</span>(score*<span class="number">10</span>-scoreInteger*<span class="number">10</span>&gt;=<span class="number">5</span>) &#123;</span><br><span class="line">        starArr.push(CLASS_HALF)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 向starArr中添加n个CLASS_OFF</span></span><br><span class="line">      <span class="keyword">while</span>(starArr.length&lt;<span class="number">5</span>) &#123;</span><br><span class="line">        starArr.push(CLASS_OFF)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> starArr</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改template模版</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star"</span> <span class="attr">:class</span>=<span class="string">"'star-'+size"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item"</span> <span class="attr">v-for</span>=<span class="string">"(sc, index) in starClasses"</span> <span class="attr">:class</span>=<span class="string">"sc"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在ShopList中import引入并注册使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Star</span> <span class="attr">:score</span>=<span class="string">"shop.rating"</span> <span class="attr">:size</span>=<span class="string">"24"</span>&gt;</span><span class="tag">&lt;/<span class="name">Star</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="12-5-使用svg显示页面加载中提示界面"><a href="#12-5-使用svg显示页面加载中提示界面" class="headerlink" title="12.5 使用svg显示页面加载中提示界面"></a>12.5 使用svg显示页面加载中提示界面</h3><ul><li><p>目前首页的内容数据已经可以异步获取并显示，但在数据还未加载完成时，为了优化用户体验，应该给出页面加载中的提示界面。</p></li><li><p>首先将svg资源图片放入相应的Msite和ShopList的images文件夹里</p></li><li><p>然后修改模版的显示条件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Msite--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-container"</span> <span class="attr">v-if</span>=<span class="string">"categorys.length"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./images/msite_back.svg"</span> <span class="attr">alt</span>=<span class="string">"back"</span> <span class="attr">v-else</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ShopList--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"shop_list"</span> <span class="attr">v-if</span>=<span class="string">"shops.length"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 循环显示6个svg图片 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in 6"</span> <span class="attr">:key</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./images/shop_back.svg"</span> <span class="attr">alt</span>=<span class="string">"back"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="13-实现登陆注册功能"><a href="#13-实现登陆注册功能" class="headerlink" title="13. 实现登陆注册功能"></a>13. 实现登陆注册功能</h2><h3 id="13-1-模块界面效果及交互功能说明"><a href="#13-1-模块界面效果及交互功能说明" class="headerlink" title="13.1 模块界面效果及交互功能说明"></a>13.1 模块界面效果及交互功能说明</h3><p><strong>1. 界面相关效果</strong></p><ol><li>切换登陆方式</li><li>手机号合法检查</li><li>倒计时效果</li><li>切换显示或隐藏密码</li><li>前台验证提示</li></ol><p>*<em>2. 前后台交互功能 *</em></p><ol><li>动态一次性图形验证码</li><li>动态一次性短信验证码</li><li>短信登陆</li><li>密码登陆</li><li>获取用户信息,实现自动登陆</li><li>退出登陆</li></ol><h3 id="13-2-效果一：切换登陆方式"><a href="#13-2-效果一：切换登陆方式" class="headerlink" title="13.2 效果一：切换登陆方式"></a>13.2 效果一：切换登陆方式</h3><ol><li>既然要切换登陆方式，就需要一个变量来标识这两种方式</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		loginWay: <span class="literal">false</span> <span class="comment">// true代表短信登陆, false代表密码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>动态绑定a标签的class和点击事件来实现点击切换样式</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login_header_title"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">:class</span>=<span class="string">"&#123;on: loginWay&#125;"</span> @<span class="attr">click</span>=<span class="string">"loginWay=true"</span>&gt;</span>短信登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">:class</span>=<span class="string">"&#123;on: !loginWay&#125;"</span> @<span class="attr">click</span>=<span class="string">"loginWay=false"</span>&gt;</span>密码登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>同时实现下面的表单登陆框自动切换</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login_content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"&#123;on: loginWay&#125;"</span>&gt;</span></span><br><span class="line">            短信登陆的input...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"&#123;on: !loginWay&#125;"</span>&gt;</span></span><br><span class="line">            密码登陆的input...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="13-3-效果二：手机号合法检查"><a href="#13-3-效果二：手机号合法检查" class="headerlink" title="13.3 效果二：手机号合法检查"></a>13.3 效果二：手机号合法检查</h3><ul><li><p>既然是要对手机号格式进行检查就要为其绑定数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--v-model的值最好按照api文档里要求的字段来命名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"tel"</span> <span class="attr">maxlength</span>=<span class="string">"11"</span> <span class="attr">placeholder</span>=<span class="string">"手机号"</span> <span class="attr">v-model</span>=<span class="string">"phone"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>根据手机号格式是否正确来动态的为获取验证码添加一个类名right_phone</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span>=<span class="string">"disabled"</span> <span class="attr">class</span>=<span class="string">"get_verification"</span> <span class="attr">:class</span>=<span class="string">"&#123;right_phone:rightPhone&#125;"</span>&gt;</span>获取验证码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>right_phone的值是根据phone来确定的，所以应该是一个计算属性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  rightPhone () &#123;</span><br><span class="line">    <span class="comment">// 利用正则对手机号进行匹配，返回布尔值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^1\d&#123;10&#125;$/</span>.test(<span class="keyword">this</span>.phone)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>此时button的disabled也应该根据rightPhone的返回值来确定</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">"!rightPhone"</span> <span class="attr">class</span>=<span class="string">"get_verification"</span> <span class="attr">:class</span>=<span class="string">"&#123;right_phone:rightPhone&#125;"</span>&gt;</span>获取验证码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在style部分加入新定义的right_phone样式</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.get_verification</span></span><br><span class="line">	...</span><br><span class="line">	&amp;<span class="selector-class">.right_phone</span></span><br><span class="line">    	<span class="attribute">color</span> black</span><br></pre></td></tr></table></figure></li></ul><h3 id="13-4-效果三：30s倒计时"><a href="#13-4-效果三：30s倒计时" class="headerlink" title="13.4 效果三：30s倒计时"></a>13.4 效果三：30s倒计时</h3><ul><li><p>点击获取验证码之后会显示30s倒计时的效果并发送获取验证码的请求</p></li><li><p>注意要阻止点击button的默认提交表单事件，所以用<code>@click.prevent</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">"!rightPhone"</span> <span class="attr">class</span>=<span class="string">"get_verification"</span> <span class="attr">:class</span>=<span class="string">"&#123;right_phone:rightPhone&#125;"</span> @<span class="attr">click.prevent</span>=<span class="string">"getCode"</span>&gt;</span>获取验证码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在data里定义定时变量computeTime，然后感觉时间判断显示的内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"get_verification"</span>&gt;</span>&#123;&#123;computeTime&gt;0 ? `($&#123;computeTime&#125;s)已发送` : '获取验证码'&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后在methods里定义定时器</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    getCode () &#123;</span><br><span class="line">     <span class="comment">// 如果当前没有计时!this.computeTime等于this.computeTime === 0</span></span><br><span class="line">       <span class="keyword">if</span>(!<span class="keyword">this</span>.computeTime) &#123;</span><br><span class="line">         <span class="comment">// 启动倒计时</span></span><br><span class="line">         <span class="keyword">this</span>.computeTime = <span class="number">30</span></span><br><span class="line">         <span class="keyword">this</span>.intervalId = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">           <span class="keyword">this</span>.computeTime--</span><br><span class="line">           <span class="keyword">if</span>(<span class="keyword">this</span>.computeTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">             <span class="comment">// 停止计时</span></span><br><span class="line">             clearInterval(<span class="keyword">this</span>.intervalId)</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;, <span class="number">1000</span>)</span><br><span class="line">       &#125;</span><br><span class="line">     <span class="comment">// 发送ajax请求（向指定手机号发送验证码短信）</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="13-5-效果四：-密码的显示隐藏"><a href="#13-5-效果四：-密码的显示隐藏" class="headerlink" title="13.5 效果四： 密码的显示隐藏"></a>13.5 效果四： 密码的显示隐藏</h3><ul><li><p>利用两个type不同的input来实现密码的显示隐藏</p></li><li><p>在data里定义showPwd(默认为false)控制两者的显隐，同时使用v-model绑定数据pwd</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"login_verification"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">maxlength</span>=<span class="string">"8"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">v-if</span>=<span class="string">"showPwd"</span> <span class="attr">v-model</span>=<span class="string">"pwd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">maxlength</span>=<span class="string">"8"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">v-else</span> <span class="attr">v-model</span>=<span class="string">"pwd"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>为滑块区域添加点击监听，用来切换showPwd的值</p></li><li><p>同时切换滑块的各种样式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"switch_button"</span> <span class="attr">:class</span>=<span class="string">"showPwd?'on':'off'"</span> @<span class="attr">click</span>=<span class="string">"showPwd=!showPwd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"switch_circle"</span> <span class="attr">:class</span>=<span class="string">"&#123;right: showPwd&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"switch_text"</span>&gt;</span>&#123;&#123;showPwd ? 'abc' : '...'&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>添加必要的style</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="selector-class">.switch_circle</span></span><br><span class="line">	...</span><br><span class="line">	&amp;<span class="selector-class">.right</span></span><br><span class="line">    	<span class="attribute">transform</span> translateX(30px)</span><br></pre></td></tr></table></figure></li></ul><h3 id="13-6-效果五：前台表单验证"><a href="#13-6-效果五：前台表单验证" class="headerlink" title="13.6 效果五：前台表单验证"></a>13.6 效果五：前台表单验证</h3><ol><li><p>首先阻止点击登录button的默认提交表单事件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span> = <span class="string">"login"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在methods里定义login方法并收集表单数据(即为未使用v-model绑定data的input添加data)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        name: <span class="string">''</span>, <span class="comment">// 用户名</span></span><br><span class="line">        code: <span class="string">''</span>, <span class="comment">// 短信验证码</span></span><br><span class="line">        captcha: <span class="string">''</span>, <span class="comment">// 图形验证码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在login里根据不同的登录方式对收集的数据进行检查</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.loginWay) &#123;  <span class="comment">// 短信登陆</span></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">this</span>.rightPhone) &#123;</span><br><span class="line">		<span class="comment">// 手机号不正确</span></span><br><span class="line">    	<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="regexp">/^\d&#123;6&#125;$/</span>.test(code)) &#123;</span><br><span class="line">        <span class="comment">// 验证必须是6位数字</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;	<span class="comment">// 密码登陆</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>要将验证失败的提示信息显示出来，可以使用自定义AlertTip弹窗组件(开发中可以用第三方插件)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AlertTip <span class="keyword">from</span> <span class="string">'../../components/AlertTip/AlertTip.vue'</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	components: &#123;</span><br><span class="line">    	AlertTip</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>为AlertTip定义状态数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        alertText: <span class="string">''</span>, <span class="comment">// 提示文本</span></span><br><span class="line">        alertShow: <span class="literal">false</span>, <span class="comment">// 是否显示警告框</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在页面中放置弹窗组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">    <span class="tag">&lt;<span class="name">AlertTip</span> <span class="attr">:alertText</span>=<span class="string">"alertText"</span> <span class="attr">v-show</span>=<span class="string">"alertShow"</span> @<span class="attr">closeTip</span>=<span class="string">"closeTip"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>抽取显示弹窗和关闭弹窗的方法，并在login方法和AlertTip中使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">showAlert (alertText) &#123;</span><br><span class="line">	<span class="keyword">this</span>.alertShow = <span class="literal">true</span></span><br><span class="line">	<span class="keyword">this</span>.alertText = alertText</span><br><span class="line">&#125;,</span><br><span class="line">closeTip () &#123;</span><br><span class="line">	<span class="keyword">this</span>.alertShow = <span class="literal">false</span></span><br><span class="line">	<span class="keyword">this</span>.alertText = <span class="string">''</span></span><br><span class="line">&#125;,</span><br><span class="line">login () &#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.loginWay) &#123;  <span class="comment">// 短信登陆</span></span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">this</span>.rightPhone) &#123;</span><br><span class="line">			<span class="comment">// 手机号不正确</span></span><br><span class="line">            <span class="keyword">this</span>.showAlert(<span class="string">'手机号不正确'</span>)</span><br><span class="line">    		<span class="keyword">return</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="regexp">/^\d&#123;6&#125;$/</span>.test(code)) &#123;</span><br><span class="line">        	<span class="keyword">this</span>.showAlert(<span class="string">'验证必须是6位数字'</span>)</span><br><span class="line">        	<span class="keyword">return</span></span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="13-7-功能一：图形验证码"><a href="#13-7-功能一：图形验证码" class="headerlink" title="13.7 功能一：图形验证码"></a>13.7 功能一：图形验证码</h3><ul><li><p>根据API文档，动态一次性图形验证码的接口为<code>http://localhost:4000/captcha</code></p></li><li><p>同时为这个img添加点击事件，让其可以点击重新发送请求，刷新图片</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"get_verification"</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/captcha"</span> <span class="attr">alt</span>=<span class="string">"captcha"</span> @<span class="attr">click</span>=<span class="string">"getCaptcha"</span> <span class="attr">ref</span>=<span class="string">"captcha"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>为这个img元素添加ref属性，方便在getCaptcha中使用</p></li><li><p>利用时间戳使其每次加载时的请求参数不一样</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getCaptcha () &#123;</span><br><span class="line">	<span class="comment">// 每次指定的src要不一样</span></span><br><span class="line">    <span class="keyword">this</span>.$refs.captcha.src = <span class="string">'http://localhost:4000/captcha?time='</span>+<span class="built_in">Date</span>.now()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="13-8-功能二：短信验证码"><a href="#13-8-功能二：短信验证码" class="headerlink" title="13.8 功能二：短信验证码"></a>13.8 功能二：短信验证码</h3><ul><li><p>利用第三方短信验证码平台(容联云通讯)提供的接口来实现</p></li><li><p>先在服务端项目将自己的sid与token填入util文件夹下的sms_util.js文件</p></li><li><p>再在客户端的登录组件中引入接口请求函数(这是为了方便处理，同样也可以在action里调用)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reqSendCode, reqSmsLogin, reqPwdLogin&#125; <span class="keyword">from</span> <span class="string">'../../api'</span></span><br></pre></td></tr></table></figure></li><li><p>在getCode方法里进行调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求返回的是promise对象，所以用到了async await</span></span><br><span class="line"><span class="keyword">async</span> getCode () &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 发送ajax请求(向指定手机号发送验证码短信) </span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqSendCode(<span class="keyword">this</span>.phone)</span><br><span class="line">    <span class="keyword">if</span>(result.code===<span class="number">1</span>) &#123; <span class="comment">// 手机号验证失败</span></span><br><span class="line">    	<span class="comment">// 显示提示</span></span><br><span class="line">        <span class="keyword">this</span>.showAlert(result.msg)</span><br><span class="line">        <span class="comment">// 停止计时</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.computeTime) &#123;</span><br><span class="line">        	<span class="keyword">this</span>.computeTime = <span class="number">0</span></span><br><span class="line">            clearInterval(<span class="keyword">this</span>.intervalId)</span><br><span class="line">            <span class="keyword">this</span>.intervalId = <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只要手机号填写正确 短信验证码也可以在服务端的控制台中查看</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="13-9-功能三：短信与密码登录"><a href="#13-9-功能三：短信与密码登录" class="headerlink" title="13.9 功能三：短信与密码登录"></a>13.9 功能三：短信与密码登录</h3><ul><li><p>在login方法里完成短信和密码登录的aiax请求</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> login () &#123;</span><br><span class="line">    <span class="keyword">let</span> result <span class="comment">// 保存登录成功后返回的数据</span></span><br><span class="line">    	...</span><br><span class="line">    	<span class="comment">// 发送ajax请求短信登陆</span></span><br><span class="line">    	result = <span class="keyword">await</span> reqSmsLogin(phone, code)</span><br><span class="line">    	...</span><br><span class="line">    	<span class="comment">// 发送ajax请求密码登陆</span></span><br><span class="line">    	result = <span class="keyword">await</span> reqPwdLogin(&#123;name, pwd, captcha&#125;)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>点击登录发送请求的同时停止计时器，然后将请求的结果进行处理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> ...</span><br><span class="line"><span class="comment">// 停止计时</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.computeTime) &#123;</span><br><span class="line">	<span class="keyword">this</span>.computeTime = <span class="number">0</span></span><br><span class="line">    clearInterval(<span class="keyword">this</span>.intervalId)</span><br><span class="line">    <span class="keyword">this</span>.intervalId = <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据结果数据处理</span></span><br><span class="line"><span class="keyword">if</span>(result.code===<span class="number">0</span>) &#123; <span class="comment">// 成功</span></span><br><span class="line">	<span class="keyword">const</span> user = result.data</span><br><span class="line"> 	<span class="comment">// 将user信息保存到vuex的state</span></span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">    <span class="comment">// 去个人中心界面</span></span><br><span class="line">    <span class="keyword">this</span>.$router.replace(<span class="string">'/profile'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 显示新的图片验证码</span></span><br><span class="line">    <span class="keyword">this</span>.getCaptcha()</span><br><span class="line">    <span class="comment">// 显示警告提示</span></span><br><span class="line">    <span class="keyword">const</span> msg = result.msg</span><br><span class="line">    <span class="keyword">this</span>.showAlert(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试用的用户名: abc，密码: 123。</p></li></ul><h3 id="13-10-功能四：获取用户信息-实现自动登陆"><a href="#13-10-功能四：获取用户信息-实现自动登陆" class="headerlink" title="13.10 功能四：获取用户信息,实现自动登陆"></a>13.10 功能四：获取用户信息,实现自动登陆</h3><p><strong>1. 将用户信息保存到vuex</strong></p><ol><li><p>在state中添加用户信息的状态数据userInfo</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userInfo: &#123;&#125; <span class="comment">// 用户信息</span></span><br></pre></td></tr></table></figure></li><li><p>在mutation-types中定义常量</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_USER_INFO = <span class="string">'receive_user_info'</span> <span class="comment">// 接收用户信息</span></span><br></pre></td></tr></table></figure></li><li><p>在mutations文件中增加改变state的方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//先import引入RECEIVE_USER_INFO</span></span><br><span class="line">  [RECEIVE_USER_INFO] (state, &#123;userInfo&#125;) &#123;</span><br><span class="line">  state.userInfo = userInfo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在actions文件中增加同步用户信息的方法</p><ul><li>因为之前已经异步获取了用户信息，所以这里将用户信息state更新的操作是同步的</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要先引入RECEIVE_USER_INFO这个mutation</span></span><br><span class="line"><span class="comment">// 同步记录用户信息 </span></span><br><span class="line">  recordUser (&#123;commit&#125;, userInfo) &#123;</span><br><span class="line">    commit(RECEIVE_USER_INFO, &#123;userInfo&#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>在Login组件中调用这个action</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将user保存到vuex的state</span></span><br><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'recordUser'</span>,user)</span><br></pre></td></tr></table></figure></li><li><p>之后可以在个人中心Profile页面读取并显示用户信息userInfo</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">...</span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapState([<span class="string">'userInfo'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"user-info-top"</span>&gt;</span>&#123;&#123;userInfo.name || '登录/注册'&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>2. 更新登录后的个人中心界面</strong></p><ul><li><p>使用用户名和密码登录时显示用户名和绑定的手机号信息</p></li><li><p>使用手机号登录时只需要显示手机号</p></li><li><p>根据用户是否登录来定义a标签不同的路由</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--userinfo路由对应的页面暂时未做--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"userInfo._id ? '/userinfo': '/login'"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-info"</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"user-info-top"</span> <span class="attr">v-if</span>=<span class="string">"!userInfo.phone"</span> &gt;</span>			&#123;&#123;userInfo.name || '登录/注册'&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    	...</span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-mobile-number"</span>&gt;</span>&#123;&#123;userInfo.phone || '暂无绑定手机号'&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>同时要注意首页Msite顶部的信息也要进行更改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">"header_login"</span> <span class="attr">slot</span>=<span class="string">"right"</span> <span class="attr">:to</span>=<span class="string">"userInfo._id ? '/userinfo': '/login'"</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"header_login_text"</span> <span class="attr">v-if</span>=<span class="string">"!userInfo._id"</span>&gt;</span></span><br><span class="line">          登录|注册</span><br><span class="line">	<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果已经登录则显示一个icon--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"header_login_text"</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont icon-yonghuming"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>3. 完成自动登录功能</strong></p><ul><li><p>服务器端的routes文件夹下的index.js中已经定义了返回用户信息的方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其中她将用户的userid取出来放入一个session会话中</span></span><br><span class="line">router.get(<span class="string">'/userinfo'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 取出userid</span></span><br><span class="line">  <span class="keyword">const</span> userid = req.session.userid</span><br><span class="line">  <span class="comment">// 查询</span></span><br><span class="line">  UserModel.findOne(&#123;<span class="attr">_id</span>: userid&#125;, _filter, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果没有, 返回错误提示</span></span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="comment">// 清除浏览器保存的userid的cookie</span></span><br><span class="line">      <span class="keyword">delete</span> req.session.userid</span><br><span class="line"></span><br><span class="line">      res.send(&#123;<span class="attr">code</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">'请先登陆'</span>&#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果有, 返回user</span></span><br><span class="line">      res.send(&#123;<span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: user&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>app.js中已经定义了这个用户登录的session会话的维持时间为24h</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">  secret: <span class="string">'12345'</span>,</span><br><span class="line">  cookie: &#123;<span class="attr">maxAge</span>: <span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span> &#125;,  <span class="comment">//设置maxAge是80000ms，即80s后session和相应的cookie失效过期</span></span><br><span class="line">  resave: <span class="literal">false</span>,</span><br><span class="line">  saveUninitialized: <span class="literal">true</span>,</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></li><li><p>api中的对应接口已经完成</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息(根据会话)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqUserInfo = <span class="function"><span class="params">()</span> =&gt;</span> ajax(BASE_URL + <span class="string">'/userinfo'</span>)</span><br></pre></td></tr></table></figure></li><li><p>在action中定义一个方法来调用这个接口</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步获取用户信息(先引入reqUserInfo接口)</span></span><br><span class="line"><span class="keyword">async</span> getUserInfo (&#123;commit&#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqUserInfo()</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> userInfo = result.data</span><br><span class="line">      commit(RECEIVE_USER_INFO, &#123;userInfo&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>最后在App.vue中引入action并触发</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> mounted () &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// this.getAddress()</span></span><br><span class="line">    <span class="keyword">this</span>.getUserInfo()</span><br><span class="line">  &#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">    ...mapActions([<span class="string">'getUserInfo'</span>])</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="13-11-功能五：退出登录"><a href="#13-11-功能五：退出登录" class="headerlink" title="13.11 功能五：退出登录"></a>13.11 功能五：退出登录</h3><ul><li><p>用户登录后在个人中心页面添加一个退出登录的按钮</p></li><li><p>下载安装mint-ui来实现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 安装mint-ui</span><br><span class="line">npm install --save mint-ui</span><br></pre></td></tr></table></figure></li><li><p>实现自动按需打包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 安装工具包</span><br><span class="line">npm install --save-dev babel-pulgin-component</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置</span></span><br><span class="line"><span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>,[<span class="string">"component"</span>, [</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"libraryName"</span>: <span class="string">"mint-ui"</span>,</span><br><span class="line">		<span class="string">"style"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">]]]</span><br></pre></td></tr></table></figure></li><li><p>引入并注册使用mint-ui的标签组件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在入口的main.js引入Button</span></span><br><span class="line"><span class="keyword">import</span> &#123;Button&#125; <span class="keyword">from</span> <span class="string">'mint-ui'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册全局组件</span></span><br><span class="line">Vue.component(Button.name, Button)</span><br></pre></td></tr></table></figure></li><li><p>在Profile页面中使用mint-ui的标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"profile_my_order border-1px"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--只有用户登录之后才会显示 同时绑定点击事件--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mt-button</span> <span class="attr">type</span>=<span class="string">"danger"</span> <span class="attr">style</span>=<span class="string">"width: 100%"</span> <span class="attr">v-if</span>=<span class="string">"userInfo._id"</span> @<span class="attr">click</span>=<span class="string">"logout"</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">mt-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>引入mint-ui的confirm确认和toast文本提示框</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MessageBox, Toast &#125; <span class="keyword">from</span> <span class="string">'mint-ui'</span></span><br><span class="line"></span><br><span class="line">logout () &#123;</span><br><span class="line">	MessageBox.confirm(<span class="string">'确认退出吗?'</span>).then(</span><br><span class="line">		action =&gt; &#123;</span><br><span class="line">         <span class="comment">// 请求退出</span></span><br><span class="line">         <span class="keyword">this</span>.$store.dispatch(<span class="string">'logout'</span>)</span><br><span class="line">         	Toast(<span class="string">'登出完成'</span>)</span><br><span class="line">         &#125;,</span><br><span class="line">		action =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'取消登录'</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在actions.js中定义退出登录的方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先引入api的index.js中定义的reqLogout接口和mutation</span></span><br><span class="line"><span class="comment">// 异步登出</span></span><br><span class="line"><span class="keyword">async</span> logout (&#123;commit&#125;) &#123;</span><br><span class="line">	<span class="keyword">const</span> result = <span class="keyword">await</span> reqLogout()</span><br><span class="line">	<span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123; commit(RESET_USER_INFO)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同时改动下列两个文件</span></span><br><span class="line"><span class="comment">//mutations-types文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RESET_USER_INFO = <span class="string">'receive_user_info'</span> <span class="comment">// 重置用户信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//mutations文件</span></span><br><span class="line">[RESET_USER_INFO] (state) &#123;</span><br><span class="line">    state.userInfo = &#123;&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="14-商家店铺界面"><a href="#14-商家店铺界面" class="headerlink" title="14. 商家店铺界面"></a>14. 商家店铺界面</h2><h3 id="14-1-商家店铺的整体页面搭建"><a href="#14-1-商家店铺的整体页面搭建" class="headerlink" title="14.1 商家店铺的整体页面搭建"></a>14.1 商家店铺的整体页面搭建</h3><blockquote><p>通过点击商家列表(ShopList)里的某一项进入商家店铺的一级路由界面(Shop.vue)，商家店铺界面包括顶部的一个头部的一般组件(ShopHeader.vue)和下面三个可以切换的路由子组件(ShopGoods、ShopInfo、ShopRatings)</p></blockquote><ol><li><p>在router文件夹下的index.js文件中将路由组件注册成路由</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	path: <span class="string">'/shop'</span>,</span><br><span class="line">	component: Shop,</span><br><span class="line">	children: [&#123;</span><br><span class="line">		path: <span class="string">'/shop/goods'</span>,</span><br><span class="line">		component: ShopGoods</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">        path: <span class="string">'/shop/ratings'</span>,</span><br><span class="line">        component: ShopRatings</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		path: <span class="string">'/shop/info'</span>,</span><br><span class="line">        component: ShopInfo</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">        path: <span class="string">''</span>,</span><br><span class="line">        redirect: <span class="string">'/shop/goods'</span></span><br><span class="line">	&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在ShopList.vue中为商家列表添加点击事件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"shop_list"</span> <span class="attr">v-if</span>=<span class="string">"shops.length"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"shop_li border-1px"</span> <span class="attr">v-for</span>=<span class="string">"(shop,index) in shops"</span> <span class="attr">:key</span>=<span class="string">"index"</span> @<span class="attr">click</span>=<span class="string">"$router.push('/shop')"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Shop.vue中引入各路由组件然后在模版中使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ShopHeader</span>&gt;</span><span class="tag">&lt;/<span class="name">ShopHeader</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab-item"</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 使用replace的方式进行路由切换 （路由懒加载） --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/shop/goods"</span> <span class="attr">replace</span>&gt;</span>点餐				<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab-item"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/shop/ratings"</span> <span class="attr">replace</span>&gt;</span>评价				<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab-item"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"/shop/info"</span> <span class="attr">replace</span>&gt;</span>商家					<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 缓存路由组件对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="14-2-Json模拟数据"><a href="#14-2-Json模拟数据" class="headerlink" title="14.2 Json模拟数据"></a>14.2 Json模拟数据</h3><p><strong>设计json数据的结构</strong></p><blockquote><p>商家店铺界面包括点餐、评价、和商家信息三个部分的数据(头部显示的数据也是商家信息)，而且这三个方面的数据直接没有顺序关系，可以使用对象结构来存储它们。</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 点餐数据里包括各种不同分类的食品，可以用数组goods[]来存放这些数据对象(没有顺序关系但属于同一类型)</span><br><span class="line">// 每一类食品除了分类名称name还有一个foods数据来存放这一类的食品</span><br><span class="line">// foods数组内的每个对象都是一个食品实例</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"goods"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            name: "精选套餐",</span><br><span class="line">            foods: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: "南瓜粥",</span><br><span class="line">                    price: 9</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    "ratings":[</span><br><span class="line">        &#123;&#125;</span><br><span class="line">    ],</span><br><span class="line">    "info":｛｝</span><br><span class="line">&#125;</span><br><span class="line">// 评价数据都属于同一类型，可以使用数组来存放[&#123;评价一&#125;,&#123;评价二&#125;..]</span><br><span class="line">// 商家信息数据没有顺序，可以统一保存到对象内</span><br></pre></td></tr></table></figure><ul><li>将设计好的data.json模拟数据保存在mock文件夹内</li></ul><p><strong>使用mockjs模拟数据接口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save mockjs</span><br></pre></td></tr></table></figure><ul><li>在mock文件夹下定义mockServer文件配置mock模拟数据的接口</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用mockjs提供mock数据接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">'mockjs'</span></span><br><span class="line"><span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">'./data.json'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回goods的接口</span></span><br><span class="line">Mock.mock(<span class="string">'/goods'</span>, &#123;<span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: data.goods&#125;)</span><br><span class="line"><span class="comment">// 返回ratings的接口</span></span><br><span class="line">Mock.mock(<span class="string">'/ratings'</span>, &#123;<span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: data.ratings&#125;)</span><br><span class="line"><span class="comment">// 返回info的接口</span></span><br><span class="line">Mock.mock(<span class="string">'/info'</span>, &#123;<span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: data.info&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// export default ???  不需要向外暴露任何数据, 只需要保存能执行即可</span></span><br></pre></td></tr></table></figure><ul><li><p>在main.js中加载mockServer文件即可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./mock/mockServer.js'</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>ajax请求mockjs模拟的数据</strong></p><ol><li><p>api/index.js中定义ajax请求方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取商家信息(下列请求由mock拦截并返回 不需要代理)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqShopInfo = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/info'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取商家评价数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqShopRatings = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/ratings'</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取商家商品数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqShopGoods = <span class="function"><span class="params">()</span> =&gt;</span> ajax(<span class="string">'/goods'</span>)</span><br></pre></td></tr></table></figure></li><li><p>再写一套用来管理从后台接收到的数据vuex配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. state</span></span><br><span class="line">goods: [], <span class="comment">// 商品列表</span></span><br><span class="line">ratings: [], <span class="comment">// 商家评价列表</span></span><br><span class="line">info: &#123;&#125; <span class="comment">// 商家信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. mutations-type</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_GOODS = <span class="string">'receive_goods'</span> <span class="comment">// 接收商品数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_RATINGS = <span class="string">'receive_ratings'</span> <span class="comment">// 接收商家评价数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_INFO = <span class="string">'receive_info'</span> <span class="comment">// 接收商家信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. mutations</span></span><br><span class="line">[RECEIVE_INFO] (state, &#123;info&#125;) &#123;</span><br><span class="line">  state.info = info</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">[RECEIVE_RATINGS] (state, &#123;ratings&#125;) &#123;</span><br><span class="line">  state.ratings = ratings</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">[RECEIVE_GOODS] (state, &#123;goods&#125;) &#123;</span><br><span class="line">  state.goods = goods</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. action</span></span><br><span class="line"><span class="comment">// 异步获取商家信息</span></span><br><span class="line">  <span class="keyword">async</span> getShopInfo (&#123;commit&#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopInfo()</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> info = result.data</span><br><span class="line">      commit(RECEIVE_INFO, &#123;info&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步获取商家评价列表</span></span><br><span class="line">  <span class="keyword">async</span> getShopRatings (&#123;commit&#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopRatings()</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> ratings = result.data</span><br><span class="line">      commit(RECEIVE_RATINGS, &#123;ratings&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步获取商家商品列表</span></span><br><span class="line">  <span class="keyword">async</span> getShopGoods (&#123;commit&#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopGoods()</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> goods = result.data</span><br><span class="line">      commit(RECEIVE_GOODS, &#123;goods&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>在shop.vue中测试获取商家信息数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以在控制台的vuex中查看到info数据</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">	<span class="keyword">this</span>.$store.dispatch(<span class="string">'getShopInfo'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="14-3-ShopHeader模板"><a href="#14-3-ShopHeader模板" class="headerlink" title="14.3 ShopHeader模板"></a>14.3 ShopHeader模板</h3><ul><li><p>已经可以获取到mock的模拟数据，接下来开始修改商家界面的头部模板</p></li><li><p>修改完模版和样式代码，然后读取vuex里的数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">      ...mapState([<span class="string">'info'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>并将info里的数据渲染到模版中，其中有几点需要注意</p><ol><li><p>为nav动态绑定背景style(删除原来的样式里的背景图片)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:style="&#123;backgroundImage: `url($&#123;info.bgImg&#125;)`&#125;"</span><br></pre></td></tr></table></figure></li><li><p>在style里定义三种不同颜色的优惠活动的类名并放进数组，然后把它们和info.supports.type关联起来</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 注意顺序要与info的type对应</span></span><br><span class="line">    supportClasses: [<span class="string">'activity-green'</span>, <span class="string">'activity-red'</span>, <span class="string">'activity-orange'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"activity"</span> <span class="attr">:class</span>=<span class="string">"supportClasses[info.supports[0].type]"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样写会报一个错误<code>Error in render: &quot;TypeError: Cannot read property &#39;0&#39; of undefined&quot;</code>因为vuex的数据是异步的，而页面刚加载时info为空对象，info.supports不存在，为undefined。所以再取它下标为0的值会报这个错误。(二级表达式info.bgImg并不会报错)</p><p>使用v-if来避免没有数据时也会解析模版</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop-header-discounts"</span> <span class="attr">v-if</span>=<span class="string">"info.supports"</span> @<span class="attr">click</span>=<span class="string">"toggleSupportShow"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>利用shopShow和supportShow来标识模态框和优惠活动列表是否显示，同时定义切换显隐的方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">	shopShow: <span class="literal">false</span>,</span><br><span class="line">	supportShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;，</span><br><span class="line">methods: &#123;</span><br><span class="line">  toggleShopShow () &#123;</span><br><span class="line">    <span class="keyword">this</span>.shopShow = !<span class="keyword">this</span>.shopShow</span><br><span class="line">  &#125;,</span><br><span class="line">  toggleSupportShow () &#123;</span><br><span class="line">    <span class="keyword">this</span>.supportShow = !<span class="keyword">this</span>.supportShow</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可以为弹窗添加一个transition动画(activity-sheet一样)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"fade"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop-brief-modal"</span> <span class="attr">v-show</span>=<span class="string">"shopShow"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后找到shop-brief-modal的样式 添加动画过程</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="selector-class">.fade-enter-active</span>, &amp;<span class="selector-class">.fade-leave-active</span> &#123;</span><br><span class="line">	<span class="attribute">transition</span>: opacity <span class="number">0.5s</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&amp;<span class="selector-class">.fade-enter</span>, &amp;<span class="selector-class">.fade-leave-to</span> &#123;</span><br><span class="line">	<span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="14-4-异步显示ShopGoods数据"><a href="#14-4-异步显示ShopGoods数据" class="headerlink" title="14.4 异步显示ShopGoods数据"></a>14.4 异步显示ShopGoods数据</h3><blockquote><p>完成了头部的ShopHeader，接下来是点餐部分的ShopGoods组件。此组件是一个比较复杂的路由组件，主要包含了3个部分：ShopCart组件（底部的购物车）、CartControl组件（购物车里的加减商品按钮组件）、Food组件（点击商品图片查看详细信息的弹窗）</p><p>另外还使用了第三方库 better-scroll: 处理UI 滑动</p></blockquote><ul><li><p>左右结构的模版布局</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 左侧的菜单选项--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-wrapper"</span> <span class="attr">ref</span>=<span class="string">"menuWrapper"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 菜单对应的是食物分类列表--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>折扣<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>优惠<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>爽口凉菜<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 右侧的食物列表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foods-wrapper"</span> <span class="attr">ref</span>=<span class="string">"foodsWrapper"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 右侧的食物列表是根据左侧的分类列表展现的--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 所以右侧是在一个分类标题列表里面嵌套着各类食物列表--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"food-list-hook"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>折扣<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">           	  <span class="tag">&lt;<span class="name">li</span>&gt;</span>南瓜粥<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span>&gt;</span>红豆薏米美肤粥<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"food-list-hook"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>优惠<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">           	  <span class="tag">&lt;<span class="name">li</span>&gt;</span>红枣山药<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span>&gt;</span>...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>其他分类...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>请求并读取数据进行模版渲染</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="comment">// 使用 axios 请求 mockjs 提供的接口</span></span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getShopGoods'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState([<span class="string">'goods'</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"menu-item"</span> <span class="attr">v-for</span>=<span class="string">"(good, index) in goods"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text bottom-border-1px"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"icon"</span> <span class="attr">:src</span>=<span class="string">"good.icon"</span> <span class="attr">v-if</span>=<span class="string">"good.icon"</span>&gt;</span></span><br><span class="line">    &#123;&#123;good.name&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 右侧的模版渲染同上--&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="14-5-完成用户交互功能"><a href="#14-5-完成用户交互功能" class="headerlink" title="14.5 完成用户交互功能"></a>14.5 完成用户交互功能</h3><ol><li>修改当前食品分类的样式</li><li>当滑动右侧食品列表时，更新左侧的当前分类</li><li>点击左侧某个分类，右侧列表滑动到指定位置</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--current是标识当前分类的class 而它的值应该是一个计算后的布尔值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"menu-item"</span> <span class="attr">:class</span>=<span class="string">"&#123;current: index===currentIndex&#125;"</span> &gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>设计计算属性：currentIndex</p><p>根据哪些数据来进行计算？</p><p>既然要实现左右两侧的联动，那么首先要获取一些位置信息。</p><pre><code>scrollY: 右侧食品列表滑动的Y轴坐标（滑动过程中实时变化）

tops: 所有右侧分类标题到屏幕顶部的距离，即li的top值组成的数组

    （列表第一次显示后就不再变化）</code></pre><ol><li>在滑动过程中，实时收集scrollY</li><li>列表第一次显示后，收集tops</li><li>实现currentIndex的计算逻辑</li></ol></blockquote><ul><li><p>使用better-scroll实现回弹滑动</p><p><code>npm install --save better-scroll</code></p><p><a href="https://ustbhuangyi.github.io/better-scroll/#/zh" target="_blank" rel="noopener">中文官网</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BScroll <span class="keyword">from</span> <span class="string">'better-scroll'</span></span><br><span class="line"><span class="comment">// 要考虑列表显示之后创建BScroll实例的时机</span></span><br><span class="line"><span class="comment">//（参考12.2解决swiper的bug，之前使用watch和nextTick来监听数据更新）</span></span><br><span class="line"><span class="comment">// 这里使用另一种方法 通过action的回调函数来通知组件数据已经更新</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getShopGoods'</span>, () =&gt; &#123;<span class="comment">// 数据更新后执行</span></span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 列表数据更新显示后执行</span></span><br><span class="line">        <span class="keyword">new</span> BScroll(<span class="string">'.menu-wrapper'</span>, &#123;</span><br><span class="line">          click: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">new</span> BScroll(<span class="string">'.foods-wrapper'</span>, &#123;</span><br><span class="line">          click: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同时也要修改getShopGoods这个action</span></span><br><span class="line"><span class="comment">// 异步获取商家商品列表</span></span><br><span class="line"><span class="keyword">async</span> getShopGoods (&#123;commit&#125;, callback) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopGoods()</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> goods = result.data</span><br><span class="line">    commit(RECEIVE_GOODS, &#123;goods&#125;)</span><br><span class="line">    <span class="comment">// 数据更新了, 通知一下组件</span></span><br><span class="line">    callback &amp;&amp; callback()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>收集scrollY和tops</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要收集滚动的数据，那么就要利用betterScroll对象来监听滚动事件</span></span><br><span class="line"></span><br><span class="line">_initScroll() &#123;</span><br><span class="line">	<span class="comment">// 列表显示之后创建</span></span><br><span class="line">	<span class="keyword">new</span> BScroll(<span class="string">'.menu-wrapper'</span>, &#123;</span><br><span class="line">		click: <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line">    <span class="comment">// 根据文档配置scroll选项</span></span><br><span class="line">	<span class="keyword">this</span>.foodsScroll = <span class="keyword">new</span> BScroll(<span class="string">'.foods-wrapper'</span>, &#123;</span><br><span class="line">		probeType: <span class="number">2</span>,  <span class="comment">// 因为惯性滑动不会触发</span></span><br><span class="line">		click: <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 给右侧列表绑定scroll监听</span></span><br><span class="line">	<span class="keyword">this</span>.foodsScroll.on(<span class="string">'scroll'</span>, (&#123;x, y&#125;) =&gt; &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(x, y)</span><br><span class="line">		<span class="keyword">this</span>.scrollY = <span class="built_in">Math</span>.abs(y)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125; <span class="comment">// 将其封装为初始化滚动的方法</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化tops</span></span><br><span class="line">_initTops() &#123;</span><br><span class="line">	<span class="comment">// 1. 初始化tops</span></span><br><span class="line">	<span class="keyword">const</span> tops = []</span><br><span class="line">	<span class="keyword">let</span> top = <span class="number">0</span></span><br><span class="line">     <span class="comment">// 第一个li的top为0</span></span><br><span class="line">	tops.push(top)</span><br><span class="line">	<span class="comment">// 2. 收集</span></span><br><span class="line">	<span class="comment">// 在foods列表下找到所有分类的li</span></span><br><span class="line">	<span class="keyword">const</span> lis = <span class="keyword">this</span>.$refs.foodsUl.getElementsByClassName(<span class="string">'food-list-hook'</span>)</span><br><span class="line">     <span class="built_in">Array</span>.prototype.slice.call(lis).forEach(<span class="function"><span class="params">li</span> =&gt;</span> &#123;</span><br><span class="line">     	top += li.clientHeight</span><br><span class="line">     	tops.push(top)</span><br><span class="line">     &#125;)</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 3. 更新数据</span></span><br><span class="line">     <span class="keyword">this</span>.tops = tops</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>完成计算属性currentIndex的逻辑</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">currentIndex () &#123; <span class="comment">// 初始和相关数据发生了变化</span></span><br><span class="line">	<span class="comment">// 得到条件数据</span></span><br><span class="line">	<span class="keyword">const</span> &#123;scrollY, tops&#125; = <span class="keyword">this</span></span><br><span class="line">	<span class="comment">// 根据条件计算产生一个结果</span></span><br><span class="line">	<span class="keyword">const</span> index = tops.findIndex(<span class="function">(<span class="params">top, index</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// scrollY&gt;=当前top &amp;&amp; scrollY&lt;下一个top</span></span><br><span class="line">	<span class="keyword">return</span> scrollY &gt;= top &amp;&amp; scrollY &lt; tops[index + <span class="number">1</span>]</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 返回结果(也就是当前的scrollY值属于第几个li区间)</span></span><br><span class="line">	<span class="keyword">return</span> index</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 此时可以实现滑动右侧列表更新左侧当前分类</span></span><br><span class="line"><span class="comment">// 但如果快速滑动则会出现因为惯性滑动不能正确收集scrollY值的bug</span></span><br><span class="line"><span class="comment">// 解决方法一：将probeType的值改为3 但如果不想实现监听惯性滑动触发大量事件，则需要计算滑动结束时的scrollY值来确定当前分类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在_initScroll里给右侧列表绑定scroll结束的监听</span></span><br><span class="line"><span class="keyword">this</span>.foodsScroll.on(<span class="string">'scrollEnd'</span>, (&#123;x, y&#125;) =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'scrollEnd'</span>, x, y)</span><br><span class="line">	<span class="keyword">this</span>.scrollY = <span class="built_in">Math</span>.abs(y)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>实现点击左侧分类滑动右侧食物列表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--首先为li绑定click事件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"menu-item"</span> <span class="attr">:class</span>=<span class="string">"&#123;current: index===currentIndex&#125;"</span> @<span class="attr">click</span>=<span class="string">"clickMenuItem(index)"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">clickMenuItem (index) &#123;</span><br><span class="line">	<span class="comment">// 得到目标位置的scrollY</span></span><br><span class="line">	<span class="keyword">const</span> scrollY = <span class="keyword">this</span>.tops[index]</span><br><span class="line">	<span class="comment">// 立即更新scrollY(让点击的分类项成为当前分类)</span></span><br><span class="line">	<span class="keyword">this</span>.scrollY = scrollY</span><br><span class="line">	<span class="comment">// 平滑滑动右侧列表 better-scroll里的方法</span></span><br><span class="line">	<span class="keyword">this</span>.foodsScroll.scrollTo(<span class="number">0</span>, -scrollY, <span class="number">300</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="14-6-CartControl组件"><a href="#14-6-CartControl组件" class="headerlink" title="14.6 CartControl组件"></a>14.6 CartControl组件</h3><ul><li><p>完成加减选购食物的组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cartcontrol"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 有一个动画--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"move"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"iconfont icon-remove_circle_outline"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cart-count"</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"iconfont icon-add_circle"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>分析该组件接收的props</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件里更改的数据分别对应每一种食物，所以不应该是简单的Number类型的count，而应该是food对象（该组件为其添加food.count属性）</span></span><br><span class="line">props: &#123;</span><br><span class="line">      food: <span class="built_in">Object</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// 为加减按钮绑定的点击事件</span></span><br><span class="line">methods: &#123;</span><br><span class="line">      updateFoodCount (isAdd) &#123;</span><br><span class="line">        <span class="comment">// 这里不能直接处理food.count因为food是在good里的数据对象</span></span><br><span class="line">        <span class="comment">// 应该通过vuex触发action来管理数据 并把当前的food对象参数传递过去</span></span><br><span class="line">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'updateFoodCount'</span>, &#123;isAdd, <span class="attr">food</span>: <span class="keyword">this</span>.food&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>为food添加一个新的绑定数据count</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//省略mutation-types里定义常量的过程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// action中同步更新food中的count值</span></span><br><span class="line">  updateFoodCount (&#123;commit&#125;, &#123;isAdd, food&#125;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isAdd) &#123;</span><br><span class="line">      commit(INCREMENT_FOOD_COUNT, &#123;food&#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      commit(DECREMENT_FOOD_COUNT, &#123;food&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mutation中更改数据（注意引入vue）</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">[INCREMENT_FOOD_COUNT] (state, &#123;food&#125;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!food.count) &#123; <span class="comment">// 第一次增加</span></span><br><span class="line">      <span class="comment">// food.count = 1  // 这样新增的属性没有数据绑定</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      对象</span></span><br><span class="line"><span class="comment">      属性名</span></span><br><span class="line"><span class="comment">      属性值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Vue.set(food, <span class="string">'count'</span>, <span class="number">1</span>) <span class="comment">// 让新增的属性也有数据绑定</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      food.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">[DECREMENT_FOOD_COUNT] (state, &#123;food&#125;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (food.count) &#123; <span class="comment">// 只有有值才去减</span></span><br><span class="line">      food.count--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="14-7-Food组件"><a href="#14-7-Food组件" class="headerlink" title="14.7 Food组件"></a>14.7 Food组件</h3><ul><li><p>点击某个食品，弹出该Food弹窗组件展示该食品的信息并可将其加入购物车</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 要展示食品信息，所以要接收food对象的数据</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      food: <span class="built_in">Object</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    data () &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        isShow: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">	</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="comment">// Food组件内控制显示Food组件的方法</span></span><br><span class="line">      toggleShow () &#123;</span><br><span class="line">        <span class="keyword">this</span>.isShow = !<span class="keyword">this</span>.isShow</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    components: &#123;</span><br><span class="line">      CartControl</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>在ShopGoods中引用该组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foods-wrapper"</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--为每个食品li添加点击事件 触发显示Food弹窗--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"food-item"</span>  @<span class="attr">click</span>=<span class="string">"showFood(food)"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 该组件与goods同级--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Food</span> <span class="attr">:food</span>=<span class="string">"food"</span> <span class="attr">ref</span>=<span class="string">"food"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意每个li里的CartControl 组件都使用@click.stop 来阻止了事件冒泡，就是为了防止点击加减按钮同时触发弹出Food组件</p></blockquote></li><li><p>同时控制是否显示Food组件(其实可以直接在Food组件上使用v-if，这里是为了练习在父组件中得到子组件对象并调用其方法)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示点击的food</span></span><br><span class="line">showFood (food) &#123;</span><br><span class="line">  <span class="comment">// 设置要传递给food组件的数据</span></span><br><span class="line">  <span class="keyword">this</span>.food = food</span><br><span class="line">  <span class="comment">// 显示food组件 (在父组件中调用子组件对象的方法)</span></span><br><span class="line">  <span class="keyword">this</span>.$refs.food.toggleShow()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="14-8-ShopCart组件"><a href="#14-8-ShopCart组件" class="headerlink" title="14.8 ShopCart组件"></a>14.8 ShopCart组件</h3><blockquote><p>购物车组件中存放的都是count大于0的food,这些数据既可以通过vuex来管理，也可以使用computed来动态计算goods里每个food的count来管理。但computed要经过两层的轮询而且还要考虑数据量的问题，所以还是使用vuex来管理这些cartFoods数据的效率更高。</p></blockquote><ul><li>另外要定义几个Getters来设置购物车的一些数据信息</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  totalCount (state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.cartFoods.reduce(<span class="function">(<span class="params">preTotal, food</span>) =&gt;</span> preTotal + food.count, <span class="number">0</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  totalPrice (state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.cartFoods.reduce(<span class="function">(<span class="params">preTotal, food</span>) =&gt;</span> preTotal + food.count * food.price, <span class="number">0</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  positiveSize (state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.ratings.reduce(<span class="function">(<span class="params">preTotal, rating</span>) =&gt;</span> preTotal + (rating.rateType === <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>), <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">// 在购物车中获取到cartFoods的state 以及商家的info</span></span><br><span class="line">	...mapState([<span class="string">'cartFoods'</span>, <span class="string">'info'</span>]),</span><br><span class="line">	<span class="comment">// 获取相应的Getters里的数据    </span></span><br><span class="line">	...mapGetters([<span class="string">'totalCount'</span>, <span class="string">'totalPrice'</span>]),</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 通过计算已购食品来设置购物车不同的样式和提示文字</span></span><br><span class="line">      payClass () &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;totalPrice&#125; = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">const</span> &#123;minPrice&#125; = <span class="keyword">this</span>.info</span><br><span class="line">        <span class="keyword">return</span> totalPrice&gt;=minPrice ? <span class="string">'enough'</span> : <span class="string">'not-enough'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      payText () &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;totalPrice&#125; = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">const</span> &#123;minPrice&#125; = <span class="keyword">this</span>.info</span><br><span class="line">        <span class="keyword">if</span>(totalPrice===<span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">`￥<span class="subst">$&#123;minPrice&#125;</span>元起送`</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(totalPrice&lt;minPrice) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">`还差￥<span class="subst">$&#123;minPrice-totalPrice&#125;</span>元起送`</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">'结算'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">watch: &#123;</span><br><span class="line">    totalCount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 如果总数量为0, 直接不显示</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.totalCount === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.isShow = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// return false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    isShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.isShow) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 实现BScroll的实例是一个单例</span></span><br><span class="line">          <span class="keyword">if</span> (!<span class="keyword">this</span>.scroll) &#123;</span><br><span class="line">            <span class="keyword">this</span>.scroll = <span class="keyword">new</span> BScroll(<span class="string">'.list-content'</span>, &#123;</span><br><span class="line">              click: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.scroll.refresh() <span class="comment">// 让滚动条刷新一下: 重新统计内容的高度</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.isShow</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意：要保证购物车的列表是单例，不然打开多次购物车列表会初始化多个实例，然后再点击会触发多次点击事件。</p></blockquote><ul><li><p>引入mint-ui实现清空购物车的交互</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意CLEAR_CART的mutation不能仅仅把catFoods数组清空，还要先清空goods里food的count</span></span><br><span class="line">[CLEAR_CART] (state) &#123;</span><br><span class="line">    <span class="comment">// 清除food中的count</span></span><br><span class="line">    state.cartFoods.forEach(<span class="function"><span class="params">food</span> =&gt;</span> &#123; food.count = <span class="number">0</span> &#125;)</span><br><span class="line">    <span class="comment">// 移除购物车中所有购物项</span></span><br><span class="line">    state.cartFoods = []</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="14-9-ShopRatings组件"><a href="#14-9-ShopRatings组件" class="headerlink" title="14.9 ShopRatings组件"></a>14.9 ShopRatings组件</h3><ul><li><p>商家评价组件分为上部的Star评分以及下面的用户评价信息列表</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先在mounted里通过触发action请求ratings数据</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">   <span class="comment">// 为getShopRatings这个action添加回调函数</span></span><br><span class="line">  <span class="keyword">this</span>.$store.dispatch(<span class="string">'getShopRatings'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> BScroll(<span class="keyword">this</span>.$refs.ratings, &#123;</span><br><span class="line">        click: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    onlyShowText: <span class="literal">true</span>, <span class="comment">// 是否只显示有文本的</span></span><br><span class="line">    selectType: <span class="number">2</span> <span class="comment">// 选择的评价类型: 0满意, 1不满意, 2全部</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 在computed里获取info和ratings的State数据以及返回好评数量的Getters</span></span><br><span class="line">computed: &#123;</span><br><span class="line">  ...mapState([<span class="string">'info'</span>, <span class="string">'ratings'</span>]),</span><br><span class="line">  ...mapGetters([<span class="string">'positiveSize'</span>]),</span><br><span class="line">  filterRatings () &#123;</span><br><span class="line">      <span class="comment">// 得到相关的数据</span></span><br><span class="line">    <span class="keyword">const</span> &#123;ratings, onlyShowText, selectType&#125; = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 产生一个过滤新数组</span></span><br><span class="line">    <span class="keyword">return</span> ratings.filter(<span class="function"><span class="params">rating</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;rateType, text&#125; = rating</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          条件1:</span></span><br><span class="line"><span class="comment">              selectType: 0/1/2</span></span><br><span class="line"><span class="comment">              rateType: 0/1</span></span><br><span class="line"><span class="comment">              全部 || 满意、不满意中的一种</span></span><br><span class="line"><span class="comment">              selectType===2 || selectType===rateType</span></span><br><span class="line"><span class="comment">          条件2</span></span><br><span class="line"><span class="comment">              onlyShowText: true/false</span></span><br><span class="line"><span class="comment">              text: 有值/没值</span></span><br><span class="line"><span class="comment">              符合条件一的全部评价 || 符合条件一的有文字的评价</span></span><br><span class="line"><span class="comment">              !onlyShowText || text.length&gt;0</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">      <span class="keyword">return</span> (selectType === <span class="number">2</span> || selectType === rateType) &amp;&amp; (!onlyShowText || text.length &gt; <span class="number">0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 可以在这里自己写过滤器</span></span><br><span class="line">filters: &#123;</span><br><span class="line">  dateFormat:<span class="function"><span class="keyword">function</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(input);</span><br><span class="line">    <span class="keyword">var</span> year = d.getFullYear();</span><br><span class="line">    <span class="keyword">var</span> month = d.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> day = d.getDate() &lt;<span class="number">10</span> ? <span class="string">'0'</span> + d.getDate() : <span class="string">''</span> + d.getDate();</span><br><span class="line">    <span class="keyword">var</span> hour = d.getHours();</span><br><span class="line">    <span class="keyword">var</span> minutes = d.getMinutes();</span><br><span class="line">    <span class="keyword">var</span> seconds = d.getSeconds();</span><br><span class="line">    <span class="keyword">return</span>  year+ <span class="string">'-'</span> + month + <span class="string">'-'</span> + day + <span class="string">' '</span> + hour + <span class="string">':'</span> + minutes + <span class="string">':'</span> + seconds;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>filterRatings 就是为要渲染的评价列表设置各种必要条件 使其按照用户选择进行渲染（即页面显示的列表要同时满足条件一与条件二）</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filters文件夹 也可以使用moment或date-fns(推荐)库来实现日期过滤</span></span><br><span class="line"><span class="comment">// npm install moment/date-fns --save</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="comment">// import moment from 'moment'</span></span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">'date-fns/format'</span></span><br><span class="line"><span class="comment">// 自定义过滤器</span></span><br><span class="line">Vue.filter(<span class="string">'date-format'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">value, formatStr = <span class="string">'YYYY-MM-DD HH:mm:ss'</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// return moment(value).format(formatStr)</span></span><br><span class="line">  <span class="keyword">return</span> format(value, formatStr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在main.js文件中引入注册的过滤器</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./filters'</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="14-10-ShopInfo组件"><a href="#14-10-ShopInfo组件" class="headerlink" title="14.10 ShopInfo组件"></a>14.10 ShopInfo组件</h3><ul><li><p>获取商家列表后就已经得到了商家信息info数据，但是还没有创建ShopInfo组件对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mounted之后创建BScroll对象</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">  <span class="comment">// 如果数据还没有, 直接结束</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.info.pics) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 数据有了, 可以创建BScroll对象形成滑动</span></span><br><span class="line">  <span class="keyword">this</span>._initScroll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>同时要动态计算横向滑动的ul宽度</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  _initScroll () &#123;</span><br><span class="line">    <span class="keyword">new</span> BScroll(<span class="string">'.shop-info'</span>)</span><br><span class="line">    <span class="comment">// 动态计算ul的宽度</span></span><br><span class="line">    <span class="keyword">const</span> ul = <span class="keyword">this</span>.$refs.picsUl</span><br><span class="line">    <span class="keyword">const</span> liWidth = <span class="number">120</span></span><br><span class="line">    <span class="keyword">const</span> space = <span class="number">6</span></span><br><span class="line">    <span class="keyword">const</span> count = <span class="keyword">this</span>.info.pics.length</span><br><span class="line">    ul.style.width = (liWidth + space) * count - space + <span class="string">'px'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> BScroll(<span class="string">'.pic-wrapper'</span>, &#123;</span><br><span class="line">      scrollX: <span class="literal">true</span> <span class="comment">// 水平滑动</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="15-Search组件"><a href="#15-Search组件" class="headerlink" title="15. Search组件"></a>15. Search组件</h2><ul><li><p>既然要实现搜索功能，那么就要有搜索请求的接口以及vuex数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api/index.js里 添加根据经纬度和关键字搜索商铺列表的接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqSearchShop = <span class="function">(<span class="params">geohash, keyword</span>) =&gt;</span> ajax(BASE_URL+<span class="string">'/search_shops'</span>, &#123;geohash, keyword&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步获取商家商品列表的action</span></span><br><span class="line"><span class="keyword">async</span> searchShops (&#123;commit, state&#125;, keyword) &#123;</span><br><span class="line">  <span class="keyword">const</span> geohash = state.latitude + <span class="string">','</span> + state.longitude</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqSearchShop(geohash, keyword)</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> searchShops = result.data</span><br><span class="line">    commit(RECEIVE_SEARCH_SHOPS, &#123;searchShops&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在Search组件中触发action</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">search () &#123;</span><br><span class="line">    <span class="comment">// 得到搜索关键字</span></span><br><span class="line">    <span class="keyword">const</span> keyword = <span class="keyword">this</span>.keyword.trim()</span><br><span class="line">    <span class="comment">// 进行搜索</span></span><br><span class="line">    <span class="keyword">if</span> (keyword) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$store.dispatch(<span class="string">'searchShops'</span>, keyword)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>通过router-link将搜索结果searchShops渲染出来</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"&#123;path:'/shop', query:&#123;id:item.id&#125;&#125;"</span> <span class="attr">tag</span>=<span class="string">"li"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">v-for</span>=<span class="string">"item in searchShops"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span> <span class="attr">class</span>=<span class="string">"list_li"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="16-项目优化-扩展"><a href="#16-项目优化-扩展" class="headerlink" title="16. 项目优化/扩展"></a>16. 项目优化/扩展</h2><h3 id="16-1-缓存路由组件对象"><a href="#16-1-缓存路由组件对象" class="headerlink" title="16.1 缓存路由组件对象"></a>16.1 缓存路由组件对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 好处: 复用路由组件对象, 复用内存中路由组件获取的后台数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="16-2-路由组件懒加载"><a href="#16-2-路由组件懒加载" class="headerlink" title="16.2 路由组件懒加载"></a>16.2 路由组件懒加载</h3><blockquote><p>我们写的所有Js文件最后都会打包成一个文件，而我们实际的需求是路由组件并不是一次全部加载过来，而是按需加载。所以就要在打包前就对代码进行分割，从而实现路由组件懒加载。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.js文件中 改变引入方式 实现路由组件懒加载</span></span><br><span class="line"><span class="keyword">const</span> Msite = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../pages/Msite/Msite.vue'</span>)</span><br><span class="line"><span class="keyword">const</span> Search = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../pages/Search/Search.vue'</span>)</span><br><span class="line"><span class="keyword">const</span> Order = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../pages/Order/Order.vue'</span>)</span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../pages/Profile/Profile.vue'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时的Msite等都是返回路由组件的函数，只有请求对应的路由路径时(第一次)才会执行此函数并加载路由组件</span></span><br></pre></td></tr></table></figure><blockquote><p>此时切换路由，可以在控制台NetWork里看到拆分打包后的js文件实现了按需加载</p></blockquote><h3 id="16-3-图片懒加载-vue-lazyload"><a href="#16-3-图片懒加载-vue-lazyload" class="headerlink" title="16.3 图片懒加载: vue-lazyload"></a>16.3 图片懒加载: vue-lazyload</h3><p>安装<code>npm install --save vue-loader</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在main.js文件中引入并注册插件</span></span><br><span class="line"><span class="keyword">import</span> VueLazyload <span class="keyword">from</span> <span class="string">'vue-lazyload'</span></span><br><span class="line"><span class="comment">// 将一张loading图片加载进来</span></span><br><span class="line"><span class="keyword">import</span> loading <span class="keyword">from</span> <span class="string">'./common/img/loading.gif'</span></span><br><span class="line">Vue.use(VueLazyload, &#123; <span class="comment">// 内部自定义一个指令lazy</span></span><br><span class="line">	loading</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 在图片标签中使用 （Food组件）</span></span><br><span class="line">&lt;img v-lazy=<span class="string">"food.image"</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="16-4-打包文件分析与优化"><a href="#16-4-打包文件分析与优化" class="headerlink" title="16.4 打包文件分析与优化"></a>16.4 打包文件分析与优化</h3><ul><li>vue 脚手架提供了一个用于可视化分析打包文件的包 webpack-bundle-analyzer 和配置</li><li>启用打包可视化: <code>npm run build --report</code> 可以根据可视化文件分析页面对项目进行优化</li></ul></image></div><div style="text-align:center;color:#ccc;font-size:14px">---------------- The End ----------------</div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id="wechat_subscriber_qcode" src="/uploads/wechat.jpg" alt="WH wechat" style="width:200px;max-width:100%"><div>subscribe to my blog</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> WH</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="/2019/08/22/外卖项目开发流程/" title="外卖项目开发流程">https://github.com/wh724/2019/08/22/外卖项目开发流程/</a></li><li class="post-copyright-license"><strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-NC-SA 3.0 </a>许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Vue项目/" rel="tag"><i class="fa fa-tag"></i> Vue项目</a> <a href="/tags/Web-APP/" rel="tag"><i class="fa fa-tag"></i> Web APP</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/08/07/Node-js/" rel="next" title="Node.js"><i class="fa fa-chevron-left"></i> Node.js</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/wh724.jpg" alt="WH"><p class="site-author-name" itemprop="name">WH</p><p class="site-description motion-element" itemprop="description">This is lonely,but it`s your own.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">11</span> <span class="site-state-item-name">标签</span></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/yourname" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i></a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/2019/08/22/外卖项目开发流程/" title="外卖项目开发流程" target="_blank">外卖项目开发流程</a></li><li class="recent_posts_li"><a href="/2019/08/07/Node-js/" title="Node.js" target="_blank">Node.js</a></li><li class="recent_posts_li"><a href="/2019/08/02/上传图片的四种方法/" title="上传图片的四种方法" target="_blank">上传图片的四种方法</a></li><li class="recent_posts_li"><a href="/2019/07/20/复现商城后台管理平台的小tips/" title="复现商城后台管理平台的小tips" target="_blank">复现商城后台管理平台的小tips</a></li><li class="recent_posts_li"><a href="/2019/07/19/使用HTML5-定时器实现进度条效果/" title="使用HTML5+定时器实现进度条效果" target="_blank">使用HTML5+定时器实现进度条效果</a></li></ul></div><div id="days"></div><script>function share_data_time(){window.setTimeout("share_data_time()",1e3),BirthDay=new Date("07/15/2019 00:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),secondsold=Math.floor(timeold/1e3),e_daysold=timeold/864e5,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=Math.floor(e_hrsold),e_minsold=60*(e_hrsold-hrsold),minsold=Math.floor(e_minsold),seconds=Math.floor(60*(e_minsold-minsold)),days.innerHTML="已运行:"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}share_data_time()</script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=492390949&auto=0&height=66"></iframe></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#项目开发流程"><span class="nav-number">1.</span> <span class="nav-text">项目开发流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-创建客户端项目"><span class="nav-number">1.1.</span> <span class="nav-text">1. 创建客户端项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-使用-vue-cli-脚手架-搭建项目"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 使用 vue-cli(脚手架)搭建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-项目结构分析"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 项目结构分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-编码测试与打包发布项目"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 编码测试与打包发布项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-功能需求分析"><span class="nav-number">1.2.</span> <span class="nav-text">2. 功能需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-开发资源准备"><span class="nav-number">1.3.</span> <span class="nav-text">3. 开发资源准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Css-Reset、Fastclick与Stylus"><span class="nav-number">1.4.</span> <span class="nav-text">4. Css Reset、Fastclick与Stylus</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Css-Reset"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 Css Reset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Fastclick"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 Fastclick</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Stylus"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 Stylus</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-源码目录设计"><span class="nav-number">1.5.</span> <span class="nav-text">5. 源码目录设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Vue组件化"><span class="nav-number">1.6.</span> <span class="nav-text">6. Vue组件化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-分析整个项目的-vue-组件结构"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 分析整个项目的 vue 组件结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-编写vue组件模板文件"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2 编写vue组件模板文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-引入Vue-router"><span class="nav-number">1.7.</span> <span class="nav-text">7. 引入Vue-router</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-编写router文件夹下的index-js"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.2 编写router文件夹下的index.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-编写应用的入口文件main-js"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.3 编写应用的入口文件main.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-在App-vue里使用router-view"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.4 在App.vue里使用router-view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-运行并请求不同路由路径查看效果"><span class="nav-number">1.7.4.</span> <span class="nav-text">7.5 运行并请求不同路由路径查看效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-编写组件代码"><span class="nav-number">1.8.</span> <span class="nav-text">8. 编写组件代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-FooterGuide组件"><span class="nav-number">1.8.1.</span> <span class="nav-text">8.1 FooterGuide组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-各导航路由组件"><span class="nav-number">1.8.2.</span> <span class="nav-text">8.2 各导航路由组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-1-Msite组件"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">8.2.1 Msite组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-Search组件"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">8.2.2 Search组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-Order组件"><span class="nav-number">1.8.2.3.</span> <span class="nav-text">8.2.3 Order组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-Profile组件"><span class="nav-number">1.8.2.4.</span> <span class="nav-text">8.2.4 Profile组件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-HeaderTop组件"><span class="nav-number">1.8.3.</span> <span class="nav-text">8.3 HeaderTop组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1组件的构成分析"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">8.3.1组件的构成分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-2-功能实现的技术"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">8.3.2 功能实现的技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3-组件代码"><span class="nav-number">1.8.3.3.</span> <span class="nav-text">8.3.3 组件代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-在路由组件中使用"><span class="nav-number">1.8.3.4.</span> <span class="nav-text">8.3.4 在路由组件中使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-使用swiper插件实现轮播图"><span class="nav-number">1.8.4.</span> <span class="nav-text">8.4 使用swiper插件实现轮播图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-拆分出商家列表ShopList组件"><span class="nav-number">1.8.5.</span> <span class="nav-text">8.5 拆分出商家列表ShopList组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-6-Login组件"><span class="nav-number">1.8.6.</span> <span class="nav-text">8.6 Login组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-后台应用"><span class="nav-number">1.9.</span> <span class="nav-text">9. 后台应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-说明"><span class="nav-number">1.9.1.</span> <span class="nav-text">9.1 说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-运行"><span class="nav-number">1.9.2.</span> <span class="nav-text">9.2 运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-API文档"><span class="nav-number">1.9.3.</span> <span class="nav-text">9.3 API文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-前后台交互-ajax"><span class="nav-number">1.10.</span> <span class="nav-text">10. 前后台交互 ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-封装ajax请求函数"><span class="nav-number">1.10.1.</span> <span class="nav-text">10.1 封装ajax请求函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-封装接口请求函数"><span class="nav-number">1.10.2.</span> <span class="nav-text">10.2 封装接口请求函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-配置代理并测试接口实现ajax跨域请求"><span class="nav-number">1.10.3.</span> <span class="nav-text">10.3 配置代理并测试接口实现ajax跨域请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-使用Vuex管理状态"><span class="nav-number">1.11.</span> <span class="nav-text">11. 使用Vuex管理状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-创建Store-核心仓库"><span class="nav-number">1.11.1.</span> <span class="nav-text">11.1 创建Store(核心仓库)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-模块对象"><span class="nav-number">1.11.2.</span> <span class="nav-text">11.2 模块对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-1-State"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">11.2.1 State</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-2-Mutation"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">11.2.2 Mutation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-3-Action"><span class="nav-number">1.11.2.3.</span> <span class="nav-text">11.2.3 Action</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-异步获取并显示数据"><span class="nav-number">1.11.3.</span> <span class="nav-text">11.3 异步获取并显示数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-完成Msite页面"><span class="nav-number">1.12.</span> <span class="nav-text">12. 完成Msite页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-异步显示食品分类轮播列表"><span class="nav-number">1.12.1.</span> <span class="nav-text">12.1 异步显示食品分类轮播列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-使用watch与-nextTick解决轮播的Bug"><span class="nav-number">1.12.2.</span> <span class="nav-text">12.2 使用watch与$nextTick解决轮播的Bug</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-3-异步显示商家列表"><span class="nav-number">1.12.3.</span> <span class="nav-text">12.3 异步显示商家列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4-开发评分Star组件"><span class="nav-number">1.12.4.</span> <span class="nav-text">12.4 开发评分Star组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-5-使用svg显示页面加载中提示界面"><span class="nav-number">1.12.5.</span> <span class="nav-text">12.5 使用svg显示页面加载中提示界面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-实现登陆注册功能"><span class="nav-number">1.13.</span> <span class="nav-text">13. 实现登陆注册功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-模块界面效果及交互功能说明"><span class="nav-number">1.13.1.</span> <span class="nav-text">13.1 模块界面效果及交互功能说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-效果一：切换登陆方式"><span class="nav-number">1.13.2.</span> <span class="nav-text">13.2 效果一：切换登陆方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3-效果二：手机号合法检查"><span class="nav-number">1.13.3.</span> <span class="nav-text">13.3 效果二：手机号合法检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-4-效果三：30s倒计时"><span class="nav-number">1.13.4.</span> <span class="nav-text">13.4 效果三：30s倒计时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-5-效果四：-密码的显示隐藏"><span class="nav-number">1.13.5.</span> <span class="nav-text">13.5 效果四： 密码的显示隐藏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-6-效果五：前台表单验证"><span class="nav-number">1.13.6.</span> <span class="nav-text">13.6 效果五：前台表单验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-7-功能一：图形验证码"><span class="nav-number">1.13.7.</span> <span class="nav-text">13.7 功能一：图形验证码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-8-功能二：短信验证码"><span class="nav-number">1.13.8.</span> <span class="nav-text">13.8 功能二：短信验证码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-9-功能三：短信与密码登录"><span class="nav-number">1.13.9.</span> <span class="nav-text">13.9 功能三：短信与密码登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-10-功能四：获取用户信息-实现自动登陆"><span class="nav-number">1.13.10.</span> <span class="nav-text">13.10 功能四：获取用户信息,实现自动登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-11-功能五：退出登录"><span class="nav-number">1.13.11.</span> <span class="nav-text">13.11 功能五：退出登录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-商家店铺界面"><span class="nav-number">1.14.</span> <span class="nav-text">14. 商家店铺界面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-1-商家店铺的整体页面搭建"><span class="nav-number">1.14.1.</span> <span class="nav-text">14.1 商家店铺的整体页面搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-Json模拟数据"><span class="nav-number">1.14.2.</span> <span class="nav-text">14.2 Json模拟数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-ShopHeader模板"><span class="nav-number">1.14.3.</span> <span class="nav-text">14.3 ShopHeader模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-异步显示ShopGoods数据"><span class="nav-number">1.14.4.</span> <span class="nav-text">14.4 异步显示ShopGoods数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-5-完成用户交互功能"><span class="nav-number">1.14.5.</span> <span class="nav-text">14.5 完成用户交互功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-CartControl组件"><span class="nav-number">1.14.6.</span> <span class="nav-text">14.6 CartControl组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-7-Food组件"><span class="nav-number">1.14.7.</span> <span class="nav-text">14.7 Food组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-8-ShopCart组件"><span class="nav-number">1.14.8.</span> <span class="nav-text">14.8 ShopCart组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-9-ShopRatings组件"><span class="nav-number">1.14.9.</span> <span class="nav-text">14.9 ShopRatings组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-10-ShopInfo组件"><span class="nav-number">1.14.10.</span> <span class="nav-text">14.10 ShopInfo组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-Search组件"><span class="nav-number">1.15.</span> <span class="nav-text">15. Search组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-项目优化-扩展"><span class="nav-number">1.16.</span> <span class="nav-text">16. 项目优化/扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-1-缓存路由组件对象"><span class="nav-number">1.16.1.</span> <span class="nav-text">16.1 缓存路由组件对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-2-路由组件懒加载"><span class="nav-number">1.16.2.</span> <span class="nav-text">16.2 路由组件懒加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-3-图片懒加载-vue-lazyload"><span class="nav-number">1.16.3.</span> <span class="nav-text">16.3 图片懒加载: vue-lazyload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-4-打包文件分析与优化"><span class="nav-number">1.16.4.</span> <span class="nav-text">16.4 打包文件分析与优化</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">WH</span> <span class="post-meta-divider"></span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text"></span> <span title="Site words total count">30k</span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="site-pv"><i class="fa fa-eye"></i> <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script></body></html><!-- rebuild by neat -->